# SpbTechRun: –ò–Ω—Ç–µ–ª–ª–µ–∫—Ç—É–∞–ª—å–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–π —Å–æ–ø—É—Ç—Å—Ç–≤—É—é—â–∏—Ö —Ç–æ–≤–∞—Ä–æ–≤

## –û –ø—Ä–æ–µ–∫—Ç–µ

**SpbTechRun** ‚Äî –ø–æ–ª–Ω–æ—Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–π —Ç–æ–≤–∞—Ä–æ–≤ –¥–ª—è —Ä–æ–∑–Ω–∏—á–Ω–æ–π —Å–µ—Ç–∏ —Å—Ç—Ä–æ–∏—Ç–µ–ª—å–Ω—ã—Ö –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤ –ú–ê–ö–°–ò–î–û–ú. –°–∏—Å—Ç–µ–º–∞ —Ä–µ—à–∞–µ—Ç –∑–∞–¥–∞—á—É –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –ø–æ–¥–±–æ—Ä–∞ —Å–æ–ø—É—Ç—Å—Ç–≤—É—é—â–∏—Ö —Ç–æ–≤–∞—Ä–æ–≤ –¥–ª—è —ç—Ç–∞–ø–∞ —Ä–µ–º–æ–Ω—Ç–∞ "White Box" (—á–µ—Ä–Ω–æ–≤–∞—è –æ—Ç–¥–µ–ª–∫–∞): –Ω–∞–ª–∏–≤–Ω—ã–µ –ø–æ–ª—ã, –≤—ã—Ä–∞–≤–Ω–∏–≤–∞–Ω–∏–µ —Å—Ç–µ–Ω, –º–æ–Ω—Ç–∞–∂ –ø–µ—Ä–µ–≥–æ—Ä–æ–¥–æ–∫.

**[–î–∞—Ç–∞—Å–µ—Ç—ã –∏ —ç–º–±–µ–¥–¥–∏–Ω–≥–∏ (Google Drive)](https://drive.google.com/drive/folders/1raoqlnlr_Equ8GGNeZUcAkfdRVh4iHx3?usp=sharing)**

### –ë–∏–∑–Ω–µ—Å-–∑–∞–¥–∞—á–∞

–ü—Ä–∏ –ø–æ–∫—É–ø–∫–µ —Å—Ç—Ä–æ–∏—Ç–µ–ª—å–Ω—ã—Ö –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤ –∫–ª–∏–µ–Ω—Ç—É –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –ø—Ä–∏–æ–±—Ä–µ—Å—Ç–∏ –Ω–µ —Ç–æ–ª—å–∫–æ –æ—Å–Ω–æ–≤–Ω–æ–π —Ç–æ–≤–∞—Ä (–Ω–∞–ø—Ä–∏–º–µ—Ä, —à—Ç—É–∫–∞—Ç—É—Ä–∫—É), –Ω–æ –∏ –≤–µ—Å—å –∫–æ–º–ø–ª–µ–∫—Ç —Å–æ–ø—É—Ç—Å—Ç–≤—É—é—â–∏—Ö –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤: –≥—Ä—É–Ω—Ç–æ–≤–∫—É, —à–ø–∞—Ç–µ–ª–∏, –ø—Ä–∞–≤–∏–ª–∞, —ë–º–∫–æ—Å—Ç–∏ –¥–ª—è –∑–∞–º–µ—Å–∞. **–ü—Ä–æ–±–ª–µ–º–∞:** –ø–æ–∫—É–ø–∞—Ç–µ–ª—å —á–∞—Å—Ç–æ –Ω–µ –∑–Ω–∞–µ—Ç —á—Ç–æ –µ—â—ë –Ω—É–∂–Ω–æ, –∑–∞–±—ã–≤–∞–µ—Ç –¥–æ–∫—É–ø–∏—Ç—å, –∏–ª–∏ –≤—ã–±–∏—Ä–∞–µ—Ç –Ω–µ—Å–æ–≤–º–µ—Å—Ç–∏–º—ã–µ —Ç–æ–≤–∞—Ä—ã.

**–†–µ—à–µ–Ω–∏–µ:** –°–∏—Å—Ç–µ–º–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç —Å—Ü–µ–Ω–∞—Ä–∏–π —Ä–µ–º–æ–Ω—Ç–∞ –ø–æ —Ç–æ–≤–∞—Ä–∞–º –≤ –∫–æ—Ä–∑–∏–Ω–µ –∏ —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç –Ω–µ–¥–æ—Å—Ç–∞—é—â–∏–µ —Ç–æ–≤–∞—Ä—ã, –ø–æ–≤—ã—à–∞—è —Å—Ä–µ–¥–Ω–∏–π —á–µ–∫ –∏ —É–¥–æ–±—Å—Ç–≤–æ –¥–ª—è –ø–æ–∫—É–ø–∞—Ç–µ–ª—è.

### –ö–ª—é—á–µ–≤—ã–µ –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏

| –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç—å | –û–ø–∏—Å–∞–Ω–∏–µ | –ë–∏–∑–Ω–µ—Å-—Ü–µ–Ω–Ω–æ—Å—Ç—å |
|-------------|----------|-----------------|
| **–†–∞–±–æ—Ç–∞ –≤ –∑–∞–∫—Ä—ã—Ç–æ–º –∫–æ–Ω—Ç—É—Ä–µ** | –í—Å–µ –≤—ã—á–∏—Å–ª–µ–Ω–∏—è –ª–æ–∫–∞–ª—å–Ω—ã–µ, –±–µ–∑ –≤–Ω–µ—à–Ω–∏—Ö API | –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –¥–∞–Ω–Ω—ã—Ö, –Ω–µ–∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å –æ—Ç –∏–Ω—Ç–µ—Ä–Ω–µ—Ç–∞ |
| **–°—Ü–µ–Ω–∞—Ä–Ω—ã–π –ø–æ–¥—Ö–æ–¥** | –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –Ω–∞ –æ—Å–Ω–æ–≤–µ —Ç–∏–ø–∞ —Ä–µ–º–æ–Ω—Ç–Ω—ã—Ö —Ä–∞–±–æ—Ç | –ö–æ–º–ø–ª–µ–∫—Å–Ω—ã–µ –ø—Ä–æ–¥–∞–∂–∏ –≤–º–µ—Å—Ç–æ —Ä–∞–∑–æ–≤—ã—Ö –ø–æ–∫—É–ø–æ–∫ |
| **–ù–µ–ø—Ä–µ—Ä—ã–≤–Ω–æ–µ –æ–±—É—á–µ–Ω–∏–µ** | –£–ª—É—á—à–µ–Ω–∏–µ –Ω–∞ –æ—Å–Ω–æ–≤–µ —Ñ–∏–¥–±–µ–∫–∞ –±–µ–∑ –ø–µ—Ä–µ–æ–±—É—á–µ–Ω–∏—è –Ω–µ–π—Ä–æ—Å–µ—Ç–∏ | –ú–≥–Ω–æ–≤–µ–Ω–Ω–∞—è –∞–¥–∞–ø—Ç–∞—Ü–∏—è –∫ –ø—Ä–µ–¥–ø–æ—á—Ç–µ–Ω–∏—è–º |
| **–î–≤—É—Ö—É—Ä–æ–≤–Ω–µ–≤–æ–µ —Ä–∞–Ω–∂–∏—Ä–æ–≤–∞–Ω–∏–µ** | FAISS + CatBoost –¥–ª—è —Ç–æ—á–Ω–æ—Å—Ç–∏ –∏ —Å–∫–æ—Ä–æ—Å—Ç–∏ | –í—Ä–µ–º—è –æ—Ç–≤–µ—Ç–∞ < 200ms |

---

## –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Å–∏—Å—Ç–µ–º—ã

### –û–±–∑–æ—Ä –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤

![–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Å–∏—Å—Ç–µ–º—ã](img/architecture.png)

### –ü–æ—á–µ–º—É –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å–Ω–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞?

| –†–µ—à–µ–Ω–∏–µ | –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∞ | –ü–æ—á–µ–º—É –≤—ã–±—Ä–∞–ª–∏ |
|---------|--------------|----------------|
| **–î–≤–∞ —Å–µ—Ä–≤–∏—Å–∞ (Go + Python)** | –ú–æ–Ω–æ–ª–∏—Ç –Ω–∞ –æ–¥–Ω–æ–º —è–∑—ã–∫–µ | Go ‚Äî –≤—ã—Å–æ–∫–∞—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –¥–ª—è API; Python ‚Äî –±–æ–≥–∞—Ç–∞—è ML-—ç–∫–æ—Å–∏—Å—Ç–µ–º–∞ (FAISS, CatBoost, NumPy) |
| **–û–±—â–∞—è PostgreSQL** | –û—Ç–¥–µ–ª—å–Ω—ã–µ –ë–î | –£–ø—Ä–æ—â–∞–µ—Ç —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏, –Ω–µ—Ç –ø—Ä–æ–±–ª–µ–º —Å —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–µ–π –¥–∞–Ω–Ω—ã—Ö |
| **–ü—Ä–æ–∫—Å–∏ —á–µ—Ä–µ–∑ Go** | –ü—Ä—è–º—ã–µ –∑–∞–ø—Ä–æ—Å—ã –∫ ML | –ï–¥–∏–Ω–∞—è —Ç–æ—á–∫–∞ –≤—Ö–æ–¥–∞, —Ü–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–∞—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è, rate limiting |

---

## –¢–µ—Ö–Ω–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–µ —Ä–µ—à–µ–Ω–∏—è

### Backend (Go/Gin)

#### –ü–æ—á–µ–º—É Go?
- **–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å**: –∫–æ–º–ø–∏–ª–∏—Ä—É–µ–º—ã–π —è–∑—ã–∫, –º–∏–Ω–∏–º–∞–ª—å–Ω–æ–µ –ø–æ—Ç—Ä–µ–±–ª–µ–Ω–∏–µ –ø–∞–º—è—Ç–∏
- **–ü—Ä–æ—Å—Ç–æ—Ç–∞ –¥–µ–ø–ª–æ—è**: –æ–¥–∏–Ω –±–∏–Ω–∞—Ä–Ω–∏–∫ –±–µ–∑ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
- **–ö–æ–Ω–∫—É—Ä–µ–Ω—Ç–Ω–æ—Å—Ç—å**: –≥–æ—Ä—É—Ç–∏–Ω—ã –¥–ª—è –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∑–∞–ø—Ä–æ—Å–æ–≤
- **–¢–∏–ø–∏–∑–∞—Ü–∏—è**: –æ—à–∏–±–∫–∏ –Ω–∞ —ç—Ç–∞–ø–µ –∫–æ–º–ø–∏–ª—è—Ü–∏–∏, –∞ –Ω–µ –≤ runtime

#### Redis: –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ —Å–µ—Å—Å–∏–∏

**–ü—Ä–æ–±–ª–µ–º–∞:** –ö–æ—Ä–∑–∏–Ω–∞ –¥–æ–ª–∂–Ω–∞ —Ä–∞–±–æ—Ç–∞—Ç—å –±—ã—Å—Ç—Ä–æ –∏ —Å–æ—Ö—Ä–∞–Ω—è—Ç—å—Å—è –º–µ–∂–¥—É –∑–∞–ø—Ä–æ—Å–∞–º–∏ –¥–ª—è –∞–Ω–æ–Ω–∏–º–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π. –ü—Ä–∏ —ç—Ç–æ–º –Ω—É–∂–Ω–æ –æ–±–µ—Å–ø–µ—á–∏—Ç—å:
- –ú–≥–Ω–æ–≤–µ–Ω–Ω—ã–π –æ—Ç–∫–ª–∏–∫ –ø—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ —Ç–æ–≤–∞—Ä–æ–≤ (–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –Ω–µ –∂–¥—É—Ç)
- –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∫–æ—Ä–∑–∏–Ω—ã –≥–æ—Å—Ç—è –Ω–∞ 7 –¥–Ω–µ–π –±–µ–∑ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏
- –ë–µ—Å—à–æ–≤–Ω—ã–π –ø–µ—Ä–µ—Ö–æ–¥ –∫–æ—Ä–∑–∏–Ω—ã –ø—Ä–∏ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏

**–ü–æ—á–µ–º—É –Ω–µ PostgreSQL –¥–ª—è —Å–µ—Å—Å–∏–π:** –ö–∞–∂–¥—ã–π –∑–∞–ø—Ä–æ—Å —Ç—Ä–µ–±—É–µ—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏ —Å–µ—Å—Å–∏–∏ ‚Äî —ç—Ç–æ —Ç—ã—Å—è—á–∏ –æ–±—Ä–∞—â–µ–Ω–∏–π –≤ —Å–µ–∫—É–Ω–¥—É. PostgreSQL —Å–æ–∑–¥–∞—ë—Ç overhead –Ω–∞ –∫–∞–∂–¥–æ–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ, Redis —Ä–∞–±–æ—Ç–∞–µ—Ç –≤ –ø–∞–º—è—Ç–∏ —Å O(1) –¥–æ—Å—Ç—É–ø–æ–º.

**–†–µ—à–µ–Ω–∏–µ:** Redis –∫–∞–∫ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ —Å–µ—Å—Å–∏–π –∏ –∫–æ—Ä–∑–∏–Ω—ã —Å TTL.

<img src="img/redis-cart.png" width="575" />

**Merge –∫–æ—Ä–∑–∏–Ω—ã –ø—Ä–∏ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏:**
- –ì–æ—Å—Ç—å –¥–æ–±–∞–≤–∏–ª 3 —Ç–æ–≤–∞—Ä–∞ ‚Üí –∑–∞–ª–æ–≥–∏–Ω–∏–ª—Å—è ‚Üí —Ç–æ–≤–∞—Ä—ã –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –¥–æ–±–∞–≤–ª—è—é—Ç—Å—è –∫ –µ–≥–æ –∫–æ—Ä–∑–∏–Ω–µ
- –ï—Å–ª–∏ —Ç–æ–≤–∞—Ä —É–∂–µ –±—ã–ª –≤ –∫–æ—Ä–∑–∏–Ω–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è ‚Äî –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å—É–º–º–∏—Ä—É–µ—Ç—Å—è
- –ì–æ—Å—Ç–µ–≤–∞—è –∫–æ—Ä–∑–∏–Ω–∞ –æ—á–∏—â–∞–µ—Ç—Å—è –ø–æ—Å–ª–µ merge
- –≠—Ç–æ –∫—Ä–∏—Ç–∏—á–Ω–æ –¥–ª—è –∫–æ–Ω–≤–µ—Ä—Å–∏–∏: –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ —Ç–µ—Ä—è–µ—Ç –≤—ã–±—Ä–∞–Ω–Ω—ã–µ —Ç–æ–≤–∞—Ä—ã

#### Elasticsearch: –ü–æ–ª–Ω–æ—Ç–µ–∫—Å—Ç–æ–≤—ã–π –ø–æ–∏—Å–∫

**–ü—Ä–æ–±–ª–µ–º–∞:** PostgreSQL LIKE/ILIKE –Ω–µ –ø–æ–¥—Ö–æ–¥–∏—Ç –¥–ª—è –ø–æ–∏—Å–∫–∞ —Ç–æ–≤–∞—Ä–æ–≤:
- `LIKE '%—à—Ç—É–∫–∞—Ç—É—Ä–∫–∞%'` –Ω–µ –Ω–∞–π–¥—ë—Ç "—à—Ç—É–∫–∞—Ç—É—Ä–∫–∏" –∏–ª–∏ "—à—Ç—É–∫–∞—Ç—É—Ä–∫–æ–π" (–Ω–µ—Ç –º–æ—Ä—Ñ–æ–ª–æ–≥–∏–∏)
- Full-text search –≤ PostgreSQL –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç —Ä—É—Å—Å–∫–∏–π —è–∑—ã–∫ –∏–∑ –∫–æ—Ä–æ–±–∫–∏
- –ü—Ä–∏ 100k+ —Ç–æ–≤–∞—Ä–æ–≤ LIKE —Å–∫–∞–Ω–∏—Ä—É–µ—Ç –≤—Å—é —Ç–∞–±–ª–∏—Ü—É ‚Äî —ç—Ç–æ —Å–µ–∫—É–Ω–¥—ã –≤–º–µ—Å—Ç–æ –º–∏–ª–ª–∏—Å–µ–∫—É–Ω–¥
- –ù–µ—Ç fuzzy-–ø–æ–∏—Å–∫–∞ –¥–ª—è –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –æ–ø–µ—á–∞—Ç–æ–∫ ("—à—Ç—É–∫–∞—Ç—É—Ä–∞–∫" ‚Üí –Ω–∏—á–µ–≥–æ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ)

**–ü–æ—á–µ–º—É –Ω–µ PostgreSQL Full-Text:** –¢—Ä–µ–±—É–µ—Ç —É—Å—Ç–∞–Ω–æ–≤–∫–∏ —Å–ª–æ–≤–∞—Ä–µ–π, –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏, –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç fuzzy –∏–∑ –∫–æ—Ä–æ–±–∫–∏. Elasticsearch ‚Äî —Å–ø–µ—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ —Å batteries included.

**–†–µ—à–µ–Ω–∏–µ:** Elasticsearch —Å —Ä—É—Å—Å–∫–∏–º –∞–Ω–∞–ª–∏–∑–∞—Ç–æ—Ä–æ–º –∏ fuzzy-–ø–æ–∏—Å–∫–æ–º.

**–í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏:**
- **–ú–æ—Ä—Ñ–æ–ª–æ–≥–∏—è:** "—à—Ç—É–∫–∞—Ç—É—Ä–∫–∞" –Ω–∞—Ö–æ–¥–∏—Ç "—à—Ç—É–∫–∞—Ç—É—Ä–∫–∏", "—à—Ç—É–∫–∞—Ç—É—Ä–∫–æ–π", "—à—Ç—É–∫–∞—Ç—É—Ä–∫—É"
- **Fuzzy search:** –æ–ø–µ—á–∞—Ç–∫–∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∏—Å–ø—Ä–∞–≤–ª—è—é—Ç—Å—è ("—à—Ç—É–∫–∞—Ç—É—Ä–∞–∫" ‚Üí "—à—Ç—É–∫–∞—Ç—É—Ä–∫–∞")
- **–§–∞—Å–µ—Ç–Ω—ã–π –ø–æ–∏—Å–∫:** –∞–≥—Ä–µ–≥–∞—Ü–∏–∏ –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º, –±—Ä–µ–Ω–¥–∞–º, —Ü–µ–Ω–æ–≤—ã–º –¥–∏–∞–ø–∞–∑–æ–Ω–∞–º
- **–ü–æ–¥—Å–≤–µ—Ç–∫–∞:** `<em>—à—Ç—É–∫–∞—Ç—É—Ä–∫–∞</em> –≥–∏–ø—Å–æ–≤–∞—è` ‚Äî —Å–æ–≤–ø–∞–¥–µ–Ω–∏—è –≤—ã–¥–µ–ª—è—é—Ç—Å—è –≤ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞—Ö
- **–°–∫–æ—Ä–æ—Å—Ç—å:** –ø–æ–∏—Å–∫ –ø–æ 100k —Ç–æ–≤–∞—Ä–æ–≤ –∑–∞ 10-50ms

**–ú–∞–ø–ø–∏–Ω–≥ –∏–Ω–¥–µ–∫—Å–∞:**
```json
{
  "properties": {
    "name": {
      "type": "text",
      "analyzer": "russian",
      "fields": {
        "keyword": { "type": "keyword" }
      }
    },
    "description": { "type": "text", "analyzer": "russian" },
    "category_path": { "type": "text", "analyzer": "russian" },
    "vendor": { "type": "keyword" },
    "price": { "type": "float" },
    "available": { "type": "boolean" }
  }
}
```

#### Outbox Pattern: –ù–∞–¥—ë–∂–Ω–∞—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è —Å Elasticsearch

**–ü—Ä–æ–±–ª–µ–º–∞:** –ü—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏/–æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ —Ç–æ–≤–∞—Ä–∞ –Ω—É–∂–Ω–æ –æ–±–Ω–æ–≤–∏—Ç—å –∏ PostgreSQL, –∏ Elasticsearch. –ù–∞–∏–≤–Ω—ã–π –ø–æ–¥—Ö–æ–¥:
```go
// –ü–ª–æ—Ö–æ: —á—Ç–æ –µ—Å–ª–∏ ES –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω –ø–æ—Å–ª–µ –∫–æ–º–º–∏—Ç–∞ –≤ –ë–î?
db.Create(&product)
es.Index(product)  // ‚Üê Elasticsearch —É–ø–∞–ª, —Ç–æ–≤–∞—Ä –Ω–µ –ø—Ä–æ–∏–Ω–¥–µ–∫—Å–∏—Ä–æ–≤–∞–Ω
```
–†–µ–∑—É–ª—å—Ç–∞—Ç: —Ç–æ–≤–∞—Ä –µ—Å—Ç—å –≤ –±–∞–∑–µ, –Ω–æ –Ω–µ –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –ø–æ–∏—Å–∫–æ–º. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –∂–∞–ª—É—é—Ç—Å—è.

**–ü–æ—á–µ–º—É –Ω–µ –¥–≤—É—Ö—Ñ–∞–∑–Ω—ã–π –∫–æ–º–º–∏—Ç (2PC):** –°–ª–æ–∂–Ω–æ, –º–µ–¥–ª–µ–Ω–Ω–æ, Elasticsearch –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç XA-—Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏.

**–†–µ—à–µ–Ω–∏–µ:** Outbox Pattern ‚Äî –≥–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –¥–æ—Å—Ç–∞–≤–∫–∞ —Å–æ–±—ã—Ç–∏–π —á–µ—Ä–µ–∑ —Ç–∞–±–ª–∏—Ü—É-–æ—á–µ—Ä–µ–¥—å.

<img src="img/outbox-pattern.png" width="332" />

**–ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç:**
1. –ü—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏/–æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ —Ç–æ–≤–∞—Ä–∞ **–≤ —Ç–æ–π –∂–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏** –ø–∏—à–µ–º —Å–æ–±—ã—Ç–∏–µ –≤ `search_outbox`
2. –ï—Å–ª–∏ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è –æ—Ç–∫–∞—Ç–∏–ª–∞—Å—å ‚Äî —Å–æ–±—ã—Ç–∏–µ —Ç–æ–∂–µ –æ—Ç–∫–∞—Ç–∏—Ç—Å—è (–∞—Ç–æ–º–∞—Ä–Ω–æ—Å—Ç—å)
3. Background worker –∫–∞–∂–¥—ã–µ 100ms —á–∏—Ç–∞–µ—Ç –Ω–µ–æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã–µ —Å–æ–±—ã—Ç–∏—è
4. –ò–Ω–¥–µ–∫—Å–∏—Ä—É–µ—Ç –¥–æ–∫—É–º–µ–Ω—Ç—ã –≤ Elasticsearch
5. –ü–æ–º–µ—á–∞–µ—Ç —Å–æ–±—ã—Ç–∏—è –∫–∞–∫ –æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã–µ

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:**
- **–ù–∞–¥—ë–∂–Ω–æ—Å—Ç—å:** –µ—Å–ª–∏ ES –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω ‚Äî —Å–æ–±—ã—Ç–∏—è –Ω–∞–∫–∞–ø–ª–∏–≤–∞—é—Ç—Å—è –∏ –æ–±—Ä–∞–±–æ—Ç–∞—é—Ç—Å—è –ø–æ–∑–∂–µ
- **–ö–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å:** —Ç–æ–≤–∞—Ä –ª–∏–±–æ —Å–æ–∑–¥–∞–Ω –≤–µ–∑–¥–µ, –ª–∏–±–æ –Ω–∏–≥–¥–µ (—Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è)
- **–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å:** –æ—Å–Ω–æ–≤–Ω–æ–π –∑–∞–ø—Ä–æ—Å –Ω–µ –∂–¥—ë—Ç –∏–Ω–¥–µ–∫—Å–∞—Ü–∏—é (async)
- **–ò–¥–µ–º–ø–æ—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å:** –ø–æ–≤—Ç–æ—Ä–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ —Å–æ–±—ã—Ç–∏—è –±–µ–∑–æ–ø–∞—Å–Ω–∞

#### JWT-–∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è

**–ü—Ä–æ–±–ª–µ–º–∞:** –ö–∞–∫ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –≤ stateless API?
- –°–µ—Å—Å–∏–∏ –≤ –ë–î ‚Äî –ª–∏—à–Ω—è—è –Ω–∞–≥—Ä—É–∑–∫–∞ –Ω–∞ –∫–∞–∂–¥—ã–π –∑–∞–ø—Ä–æ—Å
- –°–µ—Å—Å–∏–∏ –≤ Redis ‚Äî –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å –æ—Ç Redis –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –∑–∞–ø—Ä–æ—Å–∞
- –ù—É–∂–µ–Ω –º–µ—Ö–∞–Ω–∏–∑–º –æ—Ç–∑—ã–≤–∞ —Ç–æ–∫–µ–Ω–æ–≤ (logout, —Å–º–µ–Ω–∞ –ø–∞—Ä–æ–ª—è)

**–†–µ—à–µ–Ω–∏–µ:** JWT —Å –¥–≤—É–º—è —Ç–æ–∫–µ–Ω–∞–º–∏ + blacklist –≤ Redis.

![JWT –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è](img/jwt-auth.png)

**–¢–æ–∫–µ–Ω—ã:**
- **Access token:** 15 –º–∏–Ω—É—Ç, —Ö—Ä–∞–Ω–∏—Ç—Å—è –≤ –ø–∞–º—è—Ç–∏ –∫–ª–∏–µ–Ω—Ç–∞ (–Ω–µ localStorage ‚Äî XSS)
- **Refresh token:** 7 –¥–Ω–µ–π, httpOnly cookie (–Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω JS ‚Äî –∑–∞—â–∏—Ç–∞ –æ—Ç XSS)
- **Blacklist:** –æ—Ç–æ–∑–≤–∞–Ω–Ω—ã–µ —Ç–æ–∫–µ–Ω—ã —Ö—Ä–∞–Ω—è—Ç—Å—è –≤ Redis –¥–æ –∏—Å—Ç–µ—á–µ–Ω–∏—è –∏—Ö TTL

**–ü–æ—á–µ–º—É –¥–≤–∞ —Ç–æ–∫–µ–Ω–∞:** Access token –∫–æ—Ä–æ—Ç–∫–æ–∂–∏–≤—É—â–∏–π ‚Äî –µ—Å–ª–∏ —É–∫—Ä–∞–¥–µ–Ω, —É—â–µ—Ä–± –º–∏–Ω–∏–º–∞–ª–µ–Ω. Refresh token –¥–ª–∏–Ω–Ω—ã–π, –Ω–æ –ø–µ—Ä–µ–¥–∞—ë—Ç—Å—è —Ç–æ–ª—å–∫–æ –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ –∏ –∑–∞—â–∏—â—ë–Ω httpOnly.

---

### ML-—Å–µ—Ä–≤–∏—Å (Python/FastAPI)

#### –ü–æ—á–µ–º—É Python –¥–ª—è ML?
- **–≠–∫–æ—Å–∏—Å—Ç–µ–º–∞**: FAISS, CatBoost, NumPy, Pandas ‚Äî –Ω–∞—Ç–∏–≤–Ω–∞—è –ø–æ–¥–¥–µ—Ä–∂–∫–∞
- **FastAPI**: async –∏–∑ –∫–æ—Ä–æ–±–∫–∏, –∞–≤—Ç–æ–¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è OpenAPI
- **SQLAlchemy 2.0**: async ORM, type hints

#### Ollama: –õ–æ–∫–∞–ª—å–Ω—ã–µ —ç–º–±–µ–¥–¥–∏–Ω–≥–∏

**–ü—Ä–æ–±–ª–µ–º–∞:** –ù—É–∂–Ω—ã —Å–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫–∏–µ —ç–º–±–µ–¥–¥–∏–Ω–≥–∏ —Ç–æ–≤–∞—Ä–æ–≤ –¥–ª—è –ø–æ–∏—Å–∫–∞ –ø–æ—Ö–æ–∂–∏—Ö, –Ω–æ:
- –û–±–ª–∞—á–Ω—ã–µ API (OpenAI, Cohere) –Ω–µ–ª—å–∑—è
- –û—Ç–ø—Ä–∞–≤–∫–∞ 100k —Ç–æ–≤–∞—Ä–æ–≤ –≤–æ –≤–Ω–µ—à–Ω–∏–π API ‚Äî –¥–æ—Ä–æ–≥–æ –∏ –º–µ–¥–ª–µ–Ω–Ω–æ
- –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç—å –æ—Ç –∏–Ω—Ç–µ—Ä–Ω–µ—Ç–∞ –Ω–µ–ø—Ä–∏–µ–º–ª–µ–º–∞ –¥–ª—è production

**–ü–æ—á–µ–º—É –Ω–µ TF-IDF/Word2Vec:** –ù–µ –ø–æ–Ω–∏–º–∞—é—Ç –∫–æ–Ω—Ç–µ–∫—Å—Ç. "–®–ø–∞—Ç–µ–ª—å –¥–ª—è —à—Ç—É–∫–∞—Ç—É—Ä–∫–∏" –∏ "–∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç –¥–ª—è –Ω–∞–Ω–µ—Å–µ–Ω–∏—è —Å–º–µ—Å–∏ –Ω–∞ —Å—Ç–µ–Ω—É" ‚Äî –¥–ª—è –Ω–∏—Ö —Ä–∞–∑–Ω—ã–µ –≤–µ—â–∏, –¥–ª—è –Ω–µ–π—Ä–æ—Å–µ—Ç–∏ ‚Äî —Å–∏–Ω–æ–Ω–∏–º—ã.

**–†–µ—à–µ–Ω–∏–µ:** Ollama —Å –º–æ–¥–µ–ª—å—é `nomic-embed-text` ‚Äî –ø–æ–ª–Ω–æ—Å—Ç—å—é –ª–æ–∫–∞–ª—å–Ω—ã–π inference.

**–ü—Ä–æ—Ü–µ—Å—Å –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ —ç–º–±–µ–¥–¥–∏–Ω–≥–æ–≤:**
```python
# –§–æ—Ä–º–∏—Ä—É–µ–º —Ç–µ–∫—Å—Ç–æ–≤–æ–µ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞
text = f"""
{product.name}
–ö–∞—Ç–µ–≥–æ—Ä–∏—è: {category_path}
–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å: {vendor}
{description[:500]}
–•–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏: {params_summary}
"""

# Ollama –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç 768-–º–µ—Ä–Ω—ã–π –≤–µ–∫—Ç–æ—Ä
embedding = ollama.generate(text)  # [0.023, -0.156, ..., 0.089]

# –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤ PostgreSQL
INSERT INTO product_embeddings (product_id, embedding) VALUES (...)
```

**–•–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏:**
- –ú–æ–¥–µ–ª—å: `nomic-embed-text` (274 MB)
- –†–∞–∑–º–µ—Ä–Ω–æ—Å—Ç—å: 768
- –°–∫–æ—Ä–æ—Å—Ç—å: ~200 —Ç–æ–≤–∞—Ä–æ–≤/–º–∏–Ω—É—Ç—É –Ω–∞ CPU
- –ö–∞—á–µ—Å—Ç–≤–æ: —Å–æ–ø–æ—Å—Ç–∞–≤–∏–º–æ —Å OpenAI text-embedding-ada-002

#### FAISS: –ë—ã—Å—Ç—Ä—ã–π –≤–µ–∫—Ç–æ—Ä–Ω—ã–π –ø–æ–∏—Å–∫

**–ü—Ä–æ–±–ª–µ–º–∞:** –ü–æ–∏—Å–∫ –±–ª–∏–∂–∞–π—à–∏—Ö —Å–æ—Å–µ–¥–µ–π —Å—Ä–µ–¥–∏ 50k+ —Ç–æ–≤–∞—Ä–æ–≤ –ø–æ —ç–º–±–µ–¥–¥–∏–Ω–≥–∞–º:
- –ù–∞–∏–≤–Ω—ã–π –ø–æ–¥—Ö–æ–¥: –≤—ã—á–∏—Å–ª–∏—Ç—å –∫–æ—Å–∏–Ω—É—Å–Ω–æ–µ —Å—Ö–æ–¥—Å—Ç–≤–æ —Å–æ –≤—Å–µ–º–∏ 100k –≤–µ–∫—Ç–æ—Ä–∞–º–∏ = O(n)
- –ü—Ä–∏ 768 –∏–∑–º–µ—Ä–µ–Ω–∏—è—Ö —ç—Ç–æ ~77M –æ–ø–µ—Ä–∞—Ü–∏–π –Ω–∞ –∫–∞–∂–¥—ã–π –∑–∞–ø—Ä–æ—Å
- –î–∞–∂–µ –Ω–∞ –±—ã—Å—Ç—Ä–æ–º CPU —ç—Ç–æ 100-500ms ‚Äî —Å–ª–∏—à–∫–æ–º –º–µ–¥–ª–µ–Ω–Ω–æ –¥–ª—è real-time

**–ü–æ—á–µ–º—É –Ω–µ PostgreSQL pgvector:** –•–æ—Ä–æ—à–∏–π –≤–∞—Ä–∏–∞–Ω—Ç, –Ω–æ FAISS –±—ã—Å—Ç—Ä–µ–µ –¥–ª—è in-memory –ø–æ–∏—Å–∫–∞. pgvector –ª—É—á—à–µ –∫–æ–≥–¥–∞ –Ω—É–∂–Ω–∞ –ø–µ—Ä—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å –∏ SQL-–∑–∞–ø—Ä–æ—Å—ã.

**–†–µ—à–µ–Ω–∏–µ:** FAISS (Facebook AI Similarity Search) ‚Äî —Å–ø–µ—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –±–∏–±–ª–∏–æ—Ç–µ–∫–∞ –¥–ª—è ANN (Approximate Nearest Neighbors).

```python
# –ü—Ä–∏ —Å—Ç–∞—Ä—Ç–µ —Å–µ—Ä–≤–∏—Å–∞ –∑–∞–≥—Ä—É–∂–∞–µ–º —ç–º–±–µ–¥–¥–∏–Ω–≥–∏ –≤ –∏–Ω–¥–µ–∫—Å
index = faiss.IndexFlatIP(768)  # Inner Product (–¥–ª—è –Ω–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã—Ö = cosine)
index.add(embeddings_matrix)    # 100k –≤–µ–∫—Ç–æ—Ä–æ–≤

# –ü–æ–∏—Å–∫ —Ç–æ–ø-100 –ø–æ—Ö–æ–∂–∏—Ö –∑–∞ ~1ms
distances, indices = index.search(query_embedding, k=100)
```

**–ü–æ—á–µ–º—É IndexFlatIP:**
- –¢–æ—á–Ω—ã–π –ø–æ–∏—Å–∫ (–Ω–µ –ø—Ä–∏–±–ª–∏–∂—ë–Ω–Ω—ã–π)
- –î–ª—è 100k —Ç–æ–≤–∞—Ä–æ–≤ –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –±—ã—Å—Ç—Ä–æ (~1ms)
- –ü—Ä–∏ —Ä–æ—Å—Ç–µ –¥–æ 1M+ –º–æ–∂–Ω–æ –ø–µ—Ä–µ–∫–ª—é—á–∏—Ç—å—Å—è –Ω–∞ IVF-–∏–Ω–¥–µ–∫—Å

#### CatBoost: ML-—Ä–∞–Ω–∂–∏—Ä–æ–≤–∞–Ω–∏–µ

**–ü—Ä–æ–±–ª–µ–º–∞:** –ü—Ä–æ—Å—Ç–æ–π —Å–∫–æ—Ä–∏–Ω–≥ –ø–æ —Ñ–æ—Ä–º—É–ª–µ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç –¥–ª—è —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–π:
```python
# –ù–∞–∏–≤–Ω—ã–π –ø–æ–¥—Ö–æ–¥ ‚Äî —Ä—É—á–Ω—ã–µ –≤–µ—Å–∞
score = 0.5 * similarity + 0.3 * same_category + 0.2 * popularity
```
- –í–µ—Å–∞ –ø–æ–¥–æ–±—Ä–∞–Ω—ã "–Ω–∞ –≥–ª–∞–∑" ‚Äî –Ω–µ –æ–ø—Ç–∏–º–∞–ª—å–Ω—ã
- –ù–µ —É—á–∏—Ç—ã–≤–∞–µ—Ç –Ω–µ–ª–∏–Ω–µ–π–Ω—ã–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ (–Ω–∞–ø—Ä–∏–º–µ—Ä: —Å–∫–∏–¥–∫–∞ –≤–∞–∂–Ω–∞ —Ç–æ–ª—å–∫–æ –¥–ª—è –¥–æ—Ä–æ–≥–∏—Ö —Ç–æ–≤–∞—Ä–æ–≤)
- –ù–µ –∞–¥–∞–ø—Ç–∏—Ä—É–µ—Ç—Å—è –∫ –¥–∞–Ω–Ω—ã–º ‚Äî –Ω—É–∂–Ω–æ –≤—Ä—É—á–Ω—É—é –ø–µ—Ä–µ–Ω–∞—Å—Ç—Ä–∞–∏–≤–∞—Ç—å

**–ü–æ—á–µ–º—É –Ω–µ –Ω–µ–π—Ä–æ—Å–µ—Ç—å:** –î–ª—è 39 —Ç–∞–±–ª–∏—á–Ω—ã—Ö –ø—Ä–∏–∑–Ω–∞–∫–æ–≤ –≥—Ä–∞–¥–∏–µ–Ω—Ç–Ω—ã–π –±—É—Å—Ç–∏–Ω–≥ —Ä–∞–±–æ—Ç–∞–µ—Ç –ª—É—á—à–µ. –ù–µ–π—Ä–æ—Å–µ—Ç–∏ —Ö–æ—Ä–æ—à–∏ –¥–ª—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π/—Ç–µ–∫—Å—Ç–∞, –Ω–æ –¥–ª—è structured data CatBoost/XGBoost ‚Äî SOTA.

**–†–µ—à–µ–Ω–∏–µ:** CatBoost Ranker ‚Äî –≥—Ä–∞–¥–∏–µ–Ω—Ç–Ω—ã–π –±—É—Å—Ç–∏–Ω–≥ –¥–ª—è learning-to-rank, –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –Ω–∞—Ö–æ–¥–∏—Ç –æ–ø—Ç–∏–º–∞–ª—å–Ω—ã–µ –≤–µ—Å–∞ –∏ –Ω–µ–ª–∏–Ω–µ–π–Ω—ã–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏.

**–î–≤—É—Ö—É—Ä–æ–≤–Ω–µ–≤–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞:**

<img src="img/catboost-ranking.png" width="408" />

**39 –ø—Ä–∏–∑–Ω–∞–∫–æ–≤ –≤ 7 –≥—Ä—É–ø–ø–∞—Ö:**

| –ì—Ä—É–ø–ø–∞ | –ü—Ä–∏–∑–Ω–∞–∫–∏ | –û–ø–∏—Å–∞–Ω–∏–µ |
|--------|----------|----------|
| **–°–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫–∏–µ (6)** | cosine_similarity, l2_distance, dot_product, euclidean, manhattan, has_embedding | –ë–ª–∏–∑–æ—Å—Ç—å —ç–º–±–µ–¥–¥–∏–Ω–≥–æ–≤ |
| **–§–∏–¥–±–µ–∫ (8)** | pair_positive, pair_negative, pair_approval, scenario_positive, scenario_negative, scenario_approval, pair_total, scenario_total | –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –æ—Ü–µ–Ω–æ–∫ |
| **–¶–µ–Ω–æ–≤—ã–µ (7)** | price, price_ratio, price_diff, price_diff_percent, has_discount, discount_percent, discount_amount | –¶–µ–Ω–æ–≤—ã–µ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏ |
| **–ö–∞—Ç–µ–≥–æ—Ä–∏–π–Ω—ã–µ (5)** | same_category, same_root, category_distance, same_vendor, different_vendor | –ò–µ—Ä–∞—Ä—Ö–∏—è –∫–∞—Ç–µ–≥–æ—Ä–∏–π |
| **Co-purchase (3)** | copurchase_count, copurchase_log, copurchase_exists | –°–æ–≤–º–µ—Å—Ç–Ω—ã–µ –ø–æ–∫—É–ø–∫–∏ |
| **–ü–æ–ø—É–ª—è—Ä–Ω–æ—Å—Ç—å (7)** | has_image, is_discounted, price_bucket, name_length, view_count, cart_add_count, order_count | –ú–µ—Ç—Ä–∏–∫–∏ —Ç–æ–≤–∞—Ä–∞ |
| **–ö–æ–Ω—Ç–µ–∫—Å—Ç –∫–æ—Ä–∑–∏–Ω—ã (3)** | cart_similarity_max, cart_similarity_avg, cart_products_count | –°–≤—è–∑—å —Å –∫–æ—Ä–∑–∏–Ω–æ–π |

**–û–±—É—á–µ–Ω–∏–µ:**
```python
model = CatBoostRanker(
    iterations=500,
    learning_rate=0.05,
    depth=6,
    loss_function="YetiRank",  # Pairwise ranking loss
    eval_metric="NDCG:top=10",
)

# –î–∞–Ω–Ω—ã–µ –≥—Ä—É–ø–ø–∏—Ä—É—é—Ç—Å—è –ø–æ main_product_id (query)
model.fit(X_train, y_train, group_id=groups)
```

**–ò—Å—Ç–æ—á–Ω–∏–∫–∏ –æ–±—É—á–∞—é—â–∏—Ö –¥–∞–Ω–Ω—ã—Ö:**
- –ü–æ–∑–∏—Ç–∏–≤–Ω—ã–µ: —Ñ–∏–¥–±–µ–∫ (üëç ‚â• 5) + —Å–æ–≤–º–µ—Å—Ç–Ω—ã–µ –ø–æ–∫—É–ø–∫–∏ (copurchase ‚â• 2)
- –ù–µ–≥–∞—Ç–∏–≤–Ω—ã–µ: —Ñ–∏–¥–±–µ–∫ (üëé > üëç) + hard negatives (—Å–ª—É—á–∞–π–Ω—ã–µ —Ç–æ–≤–∞—Ä—ã)

---

### Frontend (React + TypeScript)

#### –ü–æ—á–µ–º—É —ç—Ç–æ—Ç —Å—Ç–µ–∫?

| –¢–µ—Ö–Ω–æ–ª–æ–≥–∏—è | –ü–æ—á–µ–º—É –≤—ã–±—Ä–∞–ª–∏ |
|------------|----------------|
| **React 19** | –ö–æ–º–ø–æ–Ω–µ–Ω—Ç–Ω—ã–π –ø–æ–¥—Ö–æ–¥, –æ–≥—Ä–æ–º–Ω–∞—è —ç–∫–æ—Å–∏—Å—Ç–µ–º–∞, Server Components |
| **TypeScript** | –¢–∏–ø–æ–±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å, –∞–≤—Ç–æ–¥–æ–ø–æ–ª–Ω–µ–Ω–∏–µ, —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥ –±–µ–∑ —Å—Ç—Ä–∞—Ö–∞ |
| **Vite** | –ú–≥–Ω–æ–≤–µ–Ω–Ω—ã–π HMR, –±—ã—Å—Ç—Ä–∞—è —Å–±–æ—Ä–∫–∞ (–≤ 10-100x –±—ã—Å—Ç—Ä–µ–µ Webpack) |
| **TanStack Query** | –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–ø—Ä–æ—Å–æ–≤, –¥–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏—è, –æ–ø—Ç–∏–º–∏—Å—Ç–∏—á–Ω—ã–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è |
| **Zustand** | –ü—Ä–æ—Å—Ç–æ–π state-–º–µ–Ω–µ–¥–∂–º–µ–Ω—Ç –±–µ–∑ boilerplate Redux |
| **Tailwind CSS** | Utility-first, –Ω–µ—Ç –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤ CSS, tree-shaking |

#### TanStack Query: –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–µ—Ä–≤–µ—Ä–Ω—ã–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ–º

**–ü—Ä–æ–±–ª–µ–º–∞:** –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã–º–∏ —Å —Å–µ—Ä–≤–µ—Ä–∞ –≤ React ‚Äî –±–æ–ª—å:
- –î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–ø—Ä–æ—Å–æ–≤: 3 –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞ –∑–∞–ø—Ä–∞—à–∏–≤–∞—é—Ç –æ–¥–Ω–∏ –¥–∞–Ω–Ω—ã–µ = 3 –∑–∞–ø—Ä–æ—Å–∞
- –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ: –∫–æ–≥–¥–∞ –∏–Ω–≤–∞–ª–∏–¥–∏—Ä–æ–≤–∞—Ç—å? –ö–∞–∫ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞—Ç—å –º–µ–∂–¥—É –≤–∫–ª–∞–¥–∫–∞–º–∏?
- Loading/Error —Å–æ—Å—Ç–æ—è–Ω–∏—è: –≤ –∫–∞–∂–¥–æ–º –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–µ –ø–∏—Å–∞—Ç—å `if (loading) return <Spinner />`
- Race conditions: –±—ã—Å—Ç—Ä–æ –ø–µ—Ä–µ–∫–ª—é—á–∞–µ–º —Å—Ç—Ä–∞–Ω–∏—Ü—ã ‚Äî —Å—Ç–∞—Ä—ã–π –∑–∞–ø—Ä–æ—Å –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è –ø–æ—Å–ª–µ –Ω–æ–≤–æ–≥–æ

**–ü–æ—á–µ–º—É –Ω–µ Redux/Zustand –¥–ª—è —Å–µ—Ä–≤–µ—Ä–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö:** –≠—Ç–æ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã –¥–ª—è –∫–ª–∏–µ–Ω—Ç—Å–∫–æ–≥–æ —Å–æ—Å—Ç–æ—è–Ω–∏—è. –î–ª—è —Å–µ—Ä–≤–µ—Ä–Ω–æ–≥–æ –Ω—É–∂–µ–Ω —Å–ø–µ—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –ø–æ–¥—Ö–æ–¥ —Å –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ–º, –∏–Ω–≤–∞–ª–∏–¥–∞—Ü–∏–µ–π, retry.

**–†–µ—à–µ–Ω–∏–µ:** TanStack Query (React Query) ‚Äî –±–∏–±–ª–∏–æ—Ç–µ–∫–∞ –¥–ª—è server state management.

```typescript
// –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –∫—ç—à–∏—Ä—É—é—Ç—Å—è –ø–æ product_id
export function useRecommendations(productId: number) {
  return useQuery({
    queryKey: ['recommendations', productId],
    queryFn: () => getRecommendations(productId),
    staleTime: 5 * 60 * 1000,  // 5 –º–∏–Ω—É—Ç —Å—á–∏—Ç–∞—é—Ç—Å—è —Å–≤–µ–∂–∏–º–∏
  })
}

// –°—Ü–µ–Ω–∞—Ä–∏–∏ –∫—ç—à–∏—Ä—É—é—Ç—Å—è –ø–æ –∫–æ—Ä–∑–∏–Ω–µ, –Ω–æ –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç —Å—Ç–∞—Ä—ã–µ –¥–∞–Ω–Ω—ã–µ –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏
export function useScenarioRecommendations(scenarioId: string, cartIds: number[]) {
  return useQuery({
    queryKey: ['scenarioRecommendations', scenarioId, cartIds],
    queryFn: () => getScenarioRecommendations(scenarioId, cartIds),
    placeholderData: (prev) => prev,  // –ù–µ—Ç –º–æ—Ä–≥–∞–Ω–∏—è –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏
  })
}
```

**`placeholderData` –¥–ª—è –ø–ª–∞–≤–Ω–æ–≥–æ UX:**
- –ü—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ —Ç–æ–≤–∞—Ä–∞ –≤ –∫–æ—Ä–∑–∏–Ω—É —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–µ—Ä–µ–∑–∞–ø—Ä–∞—à–∏–≤–∞—é—Ç—Å—è
- –ë–µ–∑ `placeholderData`: —ç–∫—Ä–∞–Ω –º–æ—Ä–≥–∞–µ—Ç (loading ‚Üí data)
- –° `placeholderData`: —Å—Ç–∞—Ä—ã–µ –¥–∞–Ω–Ω—ã–µ –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç—Å—è –ø–æ–∫–∞ –≥—Ä—É–∑—è—Ç—Å—è –Ω–æ–≤—ã–µ

#### Zustand: –ì–ª–æ–±–∞–ª—å–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ

```typescript
// –ü—Ä–æ—Å—Ç–æ–π store –¥–ª—è –∫–æ—Ä–∑–∏–Ω—ã
export const useCartStore = create<CartStore>((set, get) => ({
  items: [],

  addItem: async (productId, quantity) => {
    set((state) => ({
      loadingProducts: [...state.loadingProducts, productId]
    }))

    await api.addToCart(productId, quantity)

    set((state) => ({
      items: [...state.items, { productId, quantity }],
      loadingProducts: state.loadingProducts.filter(id => id !== productId)
    }))
  },

  isProductLoading: (productId) =>
    get().loadingProducts.includes(productId),
}))
```

---

## ML-—Å–∏—Å—Ç–µ–º–∞ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–π

### –î–≤–∞ —Ç–∏–ø–∞ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–π

#### –¢–∏–ø 1: –ù–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ —Ç–æ–≤–∞—Ä–∞

![–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ —Ç–æ–≤–∞—Ä–∞](img/recommendations-product.png)

#### –¢–∏–ø 2: –ü–æ —Å—Ü–µ–Ω–∞—Ä–∏—é (–∫–∞—Ä—É—Å–µ–ª—å –Ω–∞ –≥–ª–∞–≤–Ω–æ–π)

<img src="img/recommendations-scenario.png" width="646" />

### –°—Ü–µ–Ω–∞—Ä–∏–∏ —Ä–µ–º–æ–Ω—Ç–∞ (White Box)

–¢—Ä–∏ –ø—Ä–µ–¥–æ–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω—ã—Ö —Å—Ü–µ–Ω–∞—Ä–∏—è —Å —è–≤–Ω–æ –∑–∞–¥–∞–Ω–Ω—ã–º–∏ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º–∏ —Ç–æ–≤–∞—Ä–æ–≤:

#### 1. –ú–æ–Ω—Ç–∞–∂ –Ω–∞–ª–∏–≤–Ω–æ–≥–æ –ø–æ–ª–∞

| –ì—Ä—É–ø–ø–∞ | ID –∫–∞—Ç–µ–≥–æ—Ä–∏–π | –û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ |
|--------|--------------|-------------|
| –°–º–µ—Å–∏ –¥–ª—è –≤—ã—Ä–∞–≤–Ω–∏–≤–∞–Ω–∏—è –ø–æ–ª–æ–≤ | 25185, 30465, 30466 | –î–∞ |
| –ì—Ä—É–Ω—Ç–æ–≤–∫–∏ –∏ –≥–∏–¥—Ä–æ–∏–∑–æ–ª—è—Ü–∏—è | 25380, 25379, 31147, 25186 | –î–∞ |
| –Å–º–∫–æ—Å—Ç–∏ | 30072, 27175, 30814 | –î–∞ |
| –í–∞–ª–∏–∫–∏ –∏–≥–æ–ª—å—á–∞—Ç—ã–µ | 30806-30811 | –î–∞ |
| –ú–∏–∫—Å–µ—Ä—ã —Å—Ç—Ä–æ–∏—Ç–µ–ª—å–Ω—ã–µ | 29165, 30654, 23622, 33927 | –î–∞ |
| –£—Ä–æ–≤–Ω–∏ | 23708, 29926 | –ù–µ—Ç |
| –ü–ª—ë–Ω–∫–∞ –∑–∞—â–∏—Ç–Ω–∞—è | 25500, 27182, 30227 | –ù–µ—Ç |

#### 2. –ú–æ–Ω—Ç–∞–∂ –ø–µ—Ä–µ–≥–æ—Ä–æ–¥–æ–∫

| –ì—Ä—É–ø–ø–∞ | ID –∫–∞—Ç–µ–≥–æ—Ä–∏–π | –û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ |
|--------|--------------|-------------|
| –ì–∞–∑–æ–±–µ—Ç–æ–Ω–Ω—ã–µ –±–ª–æ–∫–∏ –∏ –≥–∏–ø—Å–æ–∫–∞—Ä—Ç–æ–Ω | 25229, 25165, 25166 | –î–∞ |
| –ö–ª–µ–π –º–æ–Ω—Ç–∞–∂–Ω—ã–π | 25201 | –î–∞ |
| –ì—Ä—É–Ω—Ç–æ–≤–∫–∏ | 25380, 25379, 31147 | –î–∞ |
| –®–ø–∞—Ç–ª—ë–≤–∫–∏ | 25179, 30459-30462 | –î–∞ |
| –Å–º–∫–æ—Å—Ç–∏ | 30072, 27175, 30814 | –î–∞ |
| –ú–∏–∫—Å–µ—Ä—ã —Å—Ç—Ä–æ–∏—Ç–µ–ª—å–Ω—ã–µ | 29165, 30654, 23622, 33927 | –î–∞ |

#### 3. –í—ã—Ä–∞–≤–Ω–∏–≤–∞–Ω–∏–µ —Å—Ç–µ–Ω

| –ì—Ä—É–ø–ø–∞ | ID –∫–∞—Ç–µ–≥–æ—Ä–∏–π | –û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ |
|--------|--------------|-------------|
| –®—Ç—É–∫–∞—Ç—É—Ä–∫–∞ | 25178, 30458 | –î–∞ |
| –ì—Ä—É–Ω—Ç–æ–≤–∫–∏ | 25380, 25379, 31147 | –î–∞ |
| –®–ø–∞—Ç–ª—ë–≤–∫–∏ | 25179, 30459-30462 | –î–∞ |
| –Å–º–∫–æ—Å—Ç–∏ | 30072, 27175, 30814 | –î–∞ |
| –ü—Ä–∞–≤–∏–ª–∞ | 23705 | –î–∞ |
| –®–ø–∞—Ç–µ–ª–∏ | 30226 | –î–∞ |
| –ú–∏–∫—Å–µ—Ä—ã —Å—Ç—Ä–æ–∏—Ç–µ–ª—å–Ω—ã–µ | 29165, 30654, 23622, 33927 | –î–∞ |
| –°–µ—Ç–∫–∏ –∏ —Å–µ—Ä–ø—è–Ω–∫–∞ | 27813, 30229, 30230 | –ù–µ—Ç |

### –°–∏—Å—Ç–µ–º–∞ —Ñ–∏–¥–±–µ–∫–∞

#### –ë–∞–π–µ—Å–æ–≤—Å–∫–æ–µ —Å–≥–ª–∞–∂–∏–≤–∞–Ω–∏–µ

**–ü—Ä–æ–±–ª–µ–º–∞:** –ù–∞–∏–≤–Ω—ã–π —Ä–∞—Å—á—ë—Ç —Ä–µ–π—Ç–∏–Ω–≥–∞ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–π –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç:
- –¢–æ–≤–∞—Ä —Å 1 –ª–∞–π–∫–æ–º –∏ 0 –¥–∏–∑–ª–∞–π–∫–æ–≤ = 100% approval
- –¢–æ–≤–∞—Ä —Å 100 –ª–∞–π–∫–∞–º–∏ –∏ 10 –¥–∏–∑–ª–∞–π–∫–∞–º–∏ = 91% approval
- –ü–µ—Ä–≤—ã–π —Ç–æ–≤–∞—Ä "–ª—É—á—à–µ"? –ù–µ—Ç, —É –Ω–µ–≥–æ –ø—Ä–æ—Å—Ç–æ –º–∞–ª–æ –¥–∞–Ω–Ω—ã—Ö!

–≠—Ç–æ –∫–ª–∞—Å—Å–∏—á–µ—Å–∫–∞—è –ø—Ä–æ–±–ª–µ–º–∞ cold start ‚Äî –Ω–æ–≤—ã–µ —Ç–æ–≤–∞—Ä—ã —Å –æ–¥–Ω–∏–º –ª–∞–π–∫–æ–º –≤—ã—Ç–µ—Å–Ω—è—é—Ç –ø—Ä–æ–≤–µ—Ä–µ–Ω–Ω—ã–µ.

**–†–µ—à–µ–Ω–∏–µ:** –§–æ—Ä–º—É–ª–∞ –õ–∞–ø–ª–∞—Å–∞ (Bayesian smoothing) ‚Äî –¥–æ–±–∞–≤–ª—è–µ–º "–≤–∏—Ä—Ç—É–∞–ª—å–Ω—ã–µ" –≥–æ–ª–æ—Å–∞:

```
approval_rate = (positive + 1) / (total + 2)
```

| –õ–∞–π–∫–∏ | –î–∏–∑–ª–∞–π–∫–∏ | –ù–∞–∏–≤–Ω—ã–π % | –ë–∞–π–µ—Å–æ–≤—Å–∫–∏–π % |
|-------|----------|-----------|---------------|
| 1 | 0 | 100% | 67% |
| 0 | 1 | 0% | 33% |
| 10 | 0 | 100% | 92% |
| 5 | 5 | 50% | 50% |
| 0 | 0 | N/A | 50% |

#### –¢–∏–ø—ã —Ñ–∏–¥–±–µ–∫–∞

1. **Pair feedback** ‚Äî –æ—Ü–µ–Ω–∫–∞ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–π –ø–∞—Ä—ã "–æ—Å–Ω–æ–≤–Ω–æ–π —Ç–æ–≤–∞—Ä ‚Üí —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è"
2. **Scenario feedback** ‚Äî –æ—Ü–µ–Ω–∫–∞ —Ç–æ–≤–∞—Ä–∞ –≤ –∫–æ–Ω—Ç–µ–∫—Å—Ç–µ —Å—Ü–µ–Ω–∞—Ä–∏—è

```sql
-- –°—ã—Ä–æ–π —Ñ–∏–¥–±–µ–∫ (–¥–ª—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∏)
product_pair_feedback (main_product_id, recommended_product_id, feedback_type, user_id)

-- –ê–≥—Ä–µ–≥–∏—Ä–æ–≤–∞–Ω–Ω—ã–π (–¥–ª—è —Ä–∞–Ω–∂–∏—Ä–æ–≤–∞–Ω–∏—è)
pair_feedback_stats (main_product_id, recommended_product_id, positive_count, negative_count)
```

### –≠–≤–æ–ª—é—Ü–∏—è –∫–∞—á–µ—Å—Ç–≤–∞

![–≠–≤–æ–ª—é—Ü–∏—è –∫–∞—á–µ—Å—Ç–≤–∞ ML](img/evolution.png)

---

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

### E-commerce —Ç–∞–±–ª–∏—Ü—ã

```sql
-- –ò–µ—Ä–∞—Ä—Ö–∏—è –∫–∞—Ç–µ–≥–æ—Ä–∏–π (–¥–µ—Ä–µ–≤–æ —á–µ—Ä–µ–∑ parent_id)
categories (id, name, parent_id)

-- –ö–∞—Ç–∞–ª–æ–≥ —Ç–æ–≤–∞—Ä–æ–≤ (~100k –∑–∞–ø–∏—Å–µ–π)
products (id, name, description, price, category_id, vendor, params JSONB, picture, available)

-- –ê–∫—Ü–∏–æ–Ω–Ω—ã–µ —Ü–µ–Ω—ã —Å –¥–∞—Ç–∞–º–∏
promos (id, product_id, discount_price, start_date, end_date)

-- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ —Å bcrypt-—Ö—ç—à–∞–º–∏
users (id, email, password_hash, created_at)

-- –ö–æ—Ä–∑–∏–Ω–∞ (user_id XOR session_id)
cart_items (id, user_id, session_id, product_id, quantity)

-- –ó–∞–∫–∞–∑—ã
orders (id, user_id, status, total, created_at)
order_items (id, order_id, product_id, quantity, price)
```

### ML-—Ç–∞–±–ª–∏—Ü—ã

```sql
-- –≠–º–±–µ–¥–¥–∏–Ω–≥–∏ (768-–º–µ—Ä–Ω—ã–µ float[])
product_embeddings (product_id, embedding, text_representation, created_at)

-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø—Ä–æ—Å–º–æ—Ç—Ä–æ–≤/–∫–æ—Ä–∑–∏–Ω—ã/–∑–∞–∫–∞–∑–æ–≤
product_stats (product_id, view_count, cart_add_count, order_count, updated_at)

-- –§–∏–¥–±–µ–∫
product_pair_feedback (main_product_id, recommended_product_id, feedback_type, user_id)
pair_feedback_stats (main_product_id, recommended_product_id, positive_count, negative_count)

scenario_feedback (scenario_id, group_name, product_id, feedback_type, user_id)
scenario_feedback_stats (scenario_id, group_name, product_id, positive_count, negative_count)

-- Co-purchase –∏–∑ –∑–∞–∫–∞–∑–æ–≤
copurchase_stats (product_id_1, product_id_2, copurchase_count)
```

### Outbox –¥–ª—è Elasticsearch

```sql
-- –û—á–µ—Ä–µ–¥—å —Å–æ–±—ã—Ç–∏–π –¥–ª—è –∏–Ω–¥–µ–∫—Å–∞—Ü–∏–∏
search_outbox (id, entity_type, entity_id, operation, payload JSONB, processed, created_at)
```

---

## API

### Backend (Go) ‚Äî –ø–æ—Ä—Ç 8080

| –ú–µ—Ç–æ–¥ | –≠–Ω–¥–ø–æ–∏–Ω—Ç | –û–ø–∏—Å–∞–Ω–∏–µ |
|-------|----------|----------|
| GET | `/api/products` | –°–ø–∏—Å–æ–∫ —Ç–æ–≤–∞—Ä–æ–≤ —Å –ø–∞–≥–∏–Ω–∞—Ü–∏–µ–π |
| GET | `/api/products/:id` | –î–µ—Ç–∞–ª–∏ —Ç–æ–≤–∞—Ä–∞ |
| POST | `/api/products/:id/view` | –¢—Ä–µ–∫–∏–Ω–≥ –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ |
| GET | `/api/categories` | –î–µ—Ä–µ–≤–æ –∫–∞—Ç–µ–≥–æ—Ä–∏–π |
| GET | `/api/search?q=...` | –ü–æ–ª–Ω–æ—Ç–µ–∫—Å—Ç–æ–≤—ã–π –ø–æ–∏—Å–∫ |
| POST | `/api/auth/register` | –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è |
| POST | `/api/auth/login` | –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è (JWT) |
| GET | `/api/cart` | –ö–æ—Ä–∑–∏–Ω–∞ |
| POST | `/api/cart/items` | –î–æ–±–∞–≤–∏—Ç—å —Ç–æ–≤–∞—Ä |
| DELETE | `/api/cart/items/:id` | –£–¥–∞–ª–∏—Ç—å —Ç–æ–≤–∞—Ä |
| POST | `/api/orders` | –°–æ–∑–¥–∞—Ç—å –∑–∞–∫–∞–∑ |
| GET | `/api/recommendations/:id` | –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ (–ø—Ä–æ–∫—Å–∏ –∫ ML) |
| GET | `/api/scenarios` | –°—Ü–µ–Ω–∞—Ä–∏–∏ (–ø—Ä–æ–∫—Å–∏ –∫ ML) |

### ML-—Å–µ—Ä–≤–∏—Å (Python) ‚Äî –ø–æ—Ä—Ç 8000

| –ú–µ—Ç–æ–¥ | –≠–Ω–¥–ø–æ–∏–Ω—Ç | –û–ø–∏—Å–∞–Ω–∏–µ |
|-------|----------|----------|
| GET | `/recommendations/{product_id}` | 20 —Å–æ–ø—É—Ç—Å—Ç–≤—É—é—â–∏—Ö —Ç–æ–≤–∞—Ä–æ–≤ |
| GET | `/recommendations/{id}/with-ml` | –° —è–≤–Ω—ã–º –∫–æ–Ω—Ç—Ä–æ–ª–µ–º ML |
| GET | `/scenarios` | –°–ø–∏—Å–æ–∫ —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤ |
| GET | `/scenarios/{id}/recommendations` | –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –¥–ª—è —Å—Ü–µ–Ω–∞—Ä–∏—è |
| GET | `/recommendations/scenario/auto` | –ê–≤—Ç–æ-–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Å—Ü–µ–Ω–∞—Ä–∏—è |
| POST | `/feedback` | –û—Ç–ø—Ä–∞–≤–∏—Ç—å –æ—Ü–µ–Ω–∫—É |
| POST | `/events` | –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–æ–±—ã—Ç–∏–π |
| POST | `/ml/train` | –û–±—É—á–∏—Ç—å CatBoost |
| GET | `/ml/model-info` | –°—Ç–∞—Ç—É—Å –º–æ–¥–µ–ª–∏ |

---

## –ó–∞–ø—É—Å–∫ –ø—Ä–æ–µ–∫—Ç–∞

### –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è

- Docker –∏ Docker Compose
- 8+ GB RAM
- Ollama (—Ç–æ–ª—å–∫–æ –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ —ç–º–±–µ–¥–¥–∏–Ω–≥–æ–≤)

### –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç (—Å –≥–æ—Ç–æ–≤—ã–º–∏ —ç–º–±–µ–¥–¥–∏–Ω–≥–∞–º–∏)

```bash
# 1. –ó–∞–ø—É—Å–∫ –≤—Å–µ—Ö —Å–µ—Ä–≤–∏—Å–æ–≤
docker-compose up -d

# 2. –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –∏ —ç–º–±–µ–¥–¥–∏–Ω–≥–æ–≤
cd data && pip install -r requirements.txt && python load_data.py

# 3. –ò–º–ø–æ—Ä—Ç —ç–º–±–µ–¥–¥–∏–Ω–≥–æ–≤ (—Å–∫–∞—á–∞—Ç—å —Å Google Drive)
python import_embeddings.py

# 4. –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ ML-—Å–µ—Ä–≤–∏—Å–∞ –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ —ç–º–±–µ–¥–¥–∏–Ω–≥–æ–≤ –≤ FAISS
docker-compose restart recommendations

# 5. –û–±—É—á–µ–Ω–∏–µ CatBoost (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ, —É–ª—É—á—à–∞–µ—Ç –∫–∞—á–µ—Å—Ç–≤–æ)
curl -X POST "http://localhost:8000/ml/train?iterations=500"
```

### –ü–æ–ª–Ω—ã–π –∑–∞–ø—É—Å–∫ (–≥–µ–Ω–µ—Ä–∞—Ü–∏—è —ç–º–±–µ–¥–¥–∏–Ω–≥–æ–≤ —Å –Ω—É–ª—è)

```bash
# 1. –£—Å—Ç–∞–Ω–æ–≤–∫–∞ Ollama (Mac)
brew install ollama && ollama serve  # –≤ –æ—Ç–¥–µ–ª—å–Ω–æ–º —Ç–µ—Ä–º–∏–Ω–∞–ª–µ
ollama pull nomic-embed-text

# 2. –ó–∞–ø—É—Å–∫ —Å–µ—Ä–≤–∏—Å–æ–≤
docker-compose up -d

# 3. –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö
cd data && pip install -r requirements.txt && python load_data.py

# 4. –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —ç–º–±–µ–¥–¥–∏–Ω–≥–æ–≤ (~10-30 –º–∏–Ω—É—Ç)
docker exec -it spbtechrun-recommendations-1 python -m app.generate_embeddings

# 5. –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Å–∏–Ω—Ç–µ—Ç–∏—á–µ—Å–∫–æ–≥–æ —Ñ–∏–¥–±–µ–∫–∞ –¥–ª—è —Ö–æ–ª–æ–¥–Ω–æ–≥–æ —Å—Ç–∞—Ä—Ç–∞
docker exec spbtechrun-recommendations-1 python -m app.generate_synthetic_feedback

# 6. –û–±—É—á–µ–Ω–∏–µ CatBoost
curl -X POST "http://localhost:8000/ml/train?iterations=500"

# 7. –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ ML-—Å–µ—Ä–≤–∏—Å–∞
docker-compose restart recommendations
```

### –ü–µ—Ä–µ–æ–±—É—á–µ–Ω–∏–µ CatBoost

CatBoost —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –ø–µ—Ä–µ–æ–±—É—á–∞—Ç—å –ø–æ –º–µ—Ä–µ –Ω–∞–∫–æ–ø–ª–µ–Ω–∏—è —Ñ–∏–¥–±–µ–∫–∞ –∏ –∑–∞–∫–∞–∑–æ–≤:

```bash
# –ü–µ—Ä–µ–æ–±—É—á–µ–Ω–∏–µ –º–æ–¥–µ–ª–∏ (–∑–∞–Ω–∏–º–∞–µ—Ç ~1-2 –º–∏–Ω—É—Ç—ã)
curl -X POST "http://localhost:8000/ml/train?iterations=500"

# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ –º–æ–¥–µ–ª–∏
curl "http://localhost:8000/ml/model-info"
```

**–ö–æ–≥–¥–∞ –ø–µ—Ä–µ–æ–±—É—á–∞—Ç—å:**
- –ü–æ—Å–ª–µ –Ω–∞–∫–æ–ø–ª–µ–Ω–∏—è 100+ –Ω–æ–≤—ã—Ö –æ—Ü–µ–Ω–æ–∫ —Ñ–∏–¥–±–µ–∫–∞
- –ü–æ—Å–ª–µ –∑–Ω–∞—á–∏—Ç–µ–ª—å–Ω–æ–≥–æ —Ä–æ—Å—Ç–∞ –∑–∞–∫–∞–∑–æ–≤ (co-purchase –¥–∞–Ω–Ω—ã–µ)
- –†–∞–∑ –≤ –Ω–µ–¥–µ–ª—é –ø—Ä–∏ –∞–∫—Ç–∏–≤–Ω–æ–º –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–∏

### –î–æ—Å—Ç—É–ø –∫ —Å–µ—Ä–≤–∏—Å–∞–º

| –°–µ—Ä–≤–∏—Å | URL |
|--------|-----|
| Frontend | http://localhost:3000 |
| Backend API | http://localhost:8080/api |
| ML API | http://localhost:8000 |
| Elasticsearch | http://localhost:9200 |

---

## –ú–µ—Ç—Ä–∏–∫–∏ –∫–∞—á–µ—Å—Ç–≤–∞

### ML-–º–æ–¥–µ–ª—å

| –ú–µ—Ç—Ä–∏–∫–∞ | –ó–Ω–∞—á–µ–Ω–∏–µ | –û–ø–∏—Å–∞–Ω–∏–µ |
|---------|----------|----------|
| NDCG@10 | 0.70+ | –ö–∞—á–µ—Å—Ç–≤–æ —Ä–∞–Ω–∂–∏—Ä–æ–≤–∞–Ω–∏—è —Ç–æ–ø-10 |
| AUC | 0.86+ | –°–ø–æ—Å–æ–±–Ω–æ—Å—Ç—å –æ—Ç–ª–∏—á–∞—Ç—å –ø–æ–∑–∏—Ç–∏–≤–Ω—ã–µ –æ—Ç –Ω–µ–≥–∞—Ç–∏–≤–Ω—ã—Ö |
| Inference | < 50ms | –í—Ä–µ–º—è —Ä–∞–Ω–∂–∏—Ä–æ–≤–∞–Ω–∏—è 100 –∫–∞–Ω–¥–∏–¥–∞—Ç–æ–≤ |

### –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å —Å–∏—Å—Ç–µ–º—ã

| –û–ø–µ—Ä–∞—Ü–∏—è | –í—Ä–µ–º—è | –ü—Ä–∏–º–µ—á–∞–Ω–∏–µ |
|----------|-------|------------|
| –ü–æ–∏—Å–∫ —Ç–æ–≤–∞—Ä–æ–≤ | < 50ms | Elasticsearch |
| –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ | < 200ms | FAISS + CatBoost |
| –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –≤ –∫–æ—Ä–∑–∏–Ω—É | < 100ms | Redis |
| –ó–∞–≥—Ä—É–∑–∫–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—ã | < 1s | –° –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ–º |

---

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
SpbTechRun/
‚îú‚îÄ‚îÄ backend/                      # Go API —Å–µ—Ä–≤–∏—Å
‚îÇ   ‚îú‚îÄ‚îÄ cmd/server/               # –¢–æ—á–∫–∞ –≤—Ö–æ–¥–∞
‚îÇ   ‚îú‚îÄ‚îÄ internal/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ handler/              # HTTP-–æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ service/              # –ë–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ repository/           # –†–∞–±–æ—Ç–∞ —Å –ë–î
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ cache/                # Redis-–∫—ç—à
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ search/               # Elasticsearch
‚îÇ   ‚îî‚îÄ‚îÄ migrations/               # SQL-–º–∏–≥—Ä–∞—Ü–∏–∏
‚îÇ
‚îú‚îÄ‚îÄ recommendations/              # Python ML-—Å–µ—Ä–≤–∏—Å
‚îÇ   ‚îî‚îÄ‚îÄ app/
‚îÇ       ‚îú‚îÄ‚îÄ api/                  # FastAPI —Ä–æ—É—Ç—ã
‚îÇ       ‚îú‚îÄ‚îÄ services/             # –õ–æ–≥–∏–∫–∞ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–π
‚îÇ       ‚îú‚îÄ‚îÄ ml/                   # CatBoost, Feature Extractor
‚îÇ       ‚îú‚îÄ‚îÄ core/                 # –≠–º–±–µ–¥–¥–∏–Ω–≥–∏, –∫–æ–Ω—Ñ–∏–≥
‚îÇ       ‚îî‚îÄ‚îÄ db/                   # SQLAlchemy
‚îÇ
‚îú‚îÄ‚îÄ frontend/                     # React –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
‚îÇ   ‚îî‚îÄ‚îÄ src/
‚îÇ       ‚îú‚îÄ‚îÄ pages/                # –°—Ç—Ä–∞–Ω–∏—Ü—ã
‚îÇ       ‚îú‚îÄ‚îÄ components/           # UI-–∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã
‚îÇ       ‚îú‚îÄ‚îÄ api/                  # API-–∫–ª–∏–µ–Ω—Ç—ã
‚îÇ       ‚îú‚îÄ‚îÄ hooks/                # React Query hooks
‚îÇ       ‚îî‚îÄ‚îÄ store/                # Zustand stores
‚îÇ
‚îú‚îÄ‚îÄ data/                         # –°–∫—Ä–∏–ø—Ç—ã –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö
‚îÇ   ‚îú‚îÄ‚îÄ load_data.py
‚îÇ   ‚îú‚îÄ‚îÄ export_embeddings.py
‚îÇ   ‚îî‚îÄ‚îÄ import_embeddings.py
‚îÇ
‚îî‚îÄ‚îÄ docker-compose.yml            # –û—Ä–∫–µ—Å—Ç—Ä–∞—Ü–∏—è
```
