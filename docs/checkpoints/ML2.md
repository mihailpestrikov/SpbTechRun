# ML –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ v2: –°—Ü–µ–Ω–∞—Ä–∏–∏ —Ä–µ–º–æ–Ω—Ç–∞

## –î–≤–∞ —Ç–∏–ø–∞ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–π

–°–∏—Å—Ç–µ–º–∞ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç **–¥–≤–∞ —Ç–∏–ø–∞ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–π**:

| –¢–∏–ø | –ì–¥–µ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è | API | –õ–æ–≥–∏–∫–∞ |
|-----|------------------|-----|--------|
| **–¢–∏–ø 1: –ü–æ —Ç–æ–≤–∞—Ä—É** | –°—Ç—Ä–∞–Ω–∏—Ü–∞ —Ç–æ–≤–∞—Ä–∞ `/product/{id}` | `GET /recommendations/{product_id}` | 20 —Å–æ–ø—É—Ç—Å—Ç–≤—É—é—â–∏—Ö —Ç–æ–≤–∞—Ä–æ–≤ –¥–ª—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ —Ç–æ–≤–∞—Ä–∞ |
| **–¢–∏–ø 2: –ü–æ —Å—Ü–µ–Ω–∞—Ä–∏—é** | –ì–ª–∞–≤–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞, `/scenarios/{id}` | `GET /scenarios/{id}/recommendations` | –ù–µ–¥–æ—Å—Ç–∞—é—â–∏–µ —Ç–æ–≤–∞—Ä—ã –¥–ª—è –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è —Å—Ü–µ–Ω–∞—Ä–∏—è |

–û–±–∞ —Ç–∏–ø–∞ –∏—Å–ø–æ–ª—å–∑—É—é—Ç:
- ML-—Ä–∞–Ω–∂–∏—Ä–æ–≤–∞–Ω–∏–µ (—ç–º–±–µ–¥–¥–∏–Ω–≥–∏ + —Ñ–∏–¥–±–µ–∫)
- –°–∏—Å—Ç–µ–º—É –æ—Ü–µ–Ω–æ–∫ "–ø–æ–¥–æ—à—ë–ª / –Ω–µ –ø–æ–¥–æ—à—ë–ª"
- –ù–µ–ø—Ä–µ—Ä—ã–≤–Ω–æ–µ –æ–±—É—á–µ–Ω–∏–µ –Ω–∞ –¥–µ–π—Å—Ç–≤–∏—è—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

---

## –¢–∏–ø 1: –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ —Ç–æ–≤–∞—Ä–∞

### –ö–æ–Ω—Ü–µ–ø—Ü–∏—è

–ö–æ–≥–¥–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç —Å—Ç—Ä–∞–Ω–∏—Ü—É —Ç–æ–≤–∞—Ä–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä, "–®—Ç—É–∫–∞—Ç—É—Ä–∫–∞ KNAUF –†–æ—Ç–±–∞–Ω–¥"), —Å–∏—Å—Ç–µ–º–∞ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç **20 —Å–æ–ø—É—Ç—Å—Ç–≤—É—é—â–∏—Ö —Ç–æ–≤–∞—Ä–æ–≤** ‚Äî —Ç–æ, —á—Ç–æ –Ω—É–∂–Ω–æ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å —ç—Ç–∏–º —Ç–æ–≤–∞—Ä–æ–º.

### UI –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ —Ç–æ–≤–∞—Ä–∞

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  –®–¢–£–ö–ê–¢–£–†–ö–ê KNAUF –†–û–¢–ë–ê–ù–î 30–ö–ì                                              ‚îÇ
‚îÇ  ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê  ‚îÇ
‚îÇ  [–§–æ—Ç–æ]     –¶–µ–Ω–∞: 590 ‚ÇΩ                                                    ‚îÇ
‚îÇ             [–í –∫–æ—Ä–∑–∏–Ω—É]                                                     ‚îÇ
‚îÇ                                                                             ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ                                                                             ‚îÇ
‚îÇ  –°–û–ü–£–¢–°–¢–í–£–Æ–©–ò–ï –¢–û–í–ê–†–´                                     –ü–æ–∫–∞–∑–∞—Ç—å –≤—Å–µ (20) ‚îÇ
‚îÇ  –î–ª—è —Ä–∞–±–æ—Ç—ã —Å —ç—Ç–∏–º —Ç–æ–≤–∞—Ä–æ–º –≤–∞–º –ø–æ–Ω–∞–¥–æ–±–∏—Ç—Å—è:                                ‚îÇ
‚îÇ                                                                             ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê       ‚îÇ
‚îÇ  ‚îÇ –ì—Ä—É–Ω—Ç        ‚îÇ ‚îÇ –®–ø–∞—Ç–µ–ª—å      ‚îÇ ‚îÇ –ü—Ä–∞–≤–∏–ª–æ      ‚îÇ ‚îÇ –í–µ–¥—Ä–æ        ‚îÇ       ‚îÇ
‚îÇ  ‚îÇ CERESIT CT17 ‚îÇ ‚îÇ —Ñ–∞—Å–∞–¥–Ω—ã–π     ‚îÇ ‚îÇ FIT –ü—Ä–æ—Ñ–∏    ‚îÇ ‚îÇ 90–ª          ‚îÇ       ‚îÇ
‚îÇ  ‚îÇ              ‚îÇ ‚îÇ 350–º–º        ‚îÇ ‚îÇ 2–º           ‚îÇ ‚îÇ              ‚îÇ       ‚îÇ
‚îÇ  ‚îÇ 890 ‚ÇΩ        ‚îÇ ‚îÇ 320 ‚ÇΩ        ‚îÇ ‚îÇ 890 ‚ÇΩ        ‚îÇ ‚îÇ 320 ‚ÇΩ        ‚îÇ       ‚îÇ
‚îÇ  ‚îÇ              ‚îÇ ‚îÇ              ‚îÇ ‚îÇ              ‚îÇ ‚îÇ              ‚îÇ       ‚îÇ
‚îÇ  ‚îÇ –°—Ö–æ–∂–µ—Å—Ç—å:    ‚îÇ ‚îÇ –°—Ö–æ–∂–µ—Å—Ç—å:    ‚îÇ ‚îÇ –°—Ö–æ–∂–µ—Å—Ç—å:    ‚îÇ ‚îÇ –°—Ö–æ–∂–µ—Å—Ç—å:    ‚îÇ       ‚îÇ
‚îÇ  ‚îÇ ‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà 94% ‚îÇ ‚îÇ ‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñë 87% ‚îÇ ‚îÇ ‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñë 85% ‚îÇ ‚îÇ ‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñë‚ñë 78% ‚îÇ       ‚îÇ
‚îÇ  ‚îÇ              ‚îÇ ‚îÇ              ‚îÇ ‚îÇ              ‚îÇ ‚îÇ              ‚îÇ       ‚îÇ
‚îÇ  ‚îÇ [–í –∫–æ—Ä–∑–∏–Ω—É]  ‚îÇ ‚îÇ [–í –∫–æ—Ä–∑–∏–Ω—É]  ‚îÇ ‚îÇ [–í –∫–æ—Ä–∑–∏–Ω—É]  ‚îÇ ‚îÇ [–í –∫–æ—Ä–∑–∏–Ω—É]  ‚îÇ       ‚îÇ
‚îÇ  ‚îÇ              ‚îÇ ‚îÇ              ‚îÇ ‚îÇ              ‚îÇ ‚îÇ              ‚îÇ       ‚îÇ
‚îÇ  ‚îÇ ‚óã –ü–æ–¥–æ—à—ë–ª    ‚îÇ ‚îÇ ‚óã –ü–æ–¥–æ—à—ë–ª    ‚îÇ ‚îÇ ‚óã –ü–æ–¥–æ—à—ë–ª    ‚îÇ ‚îÇ ‚óã –ü–æ–¥–æ—à—ë–ª    ‚îÇ       ‚îÇ
‚îÇ  ‚îÇ ‚óã –ù–µ –ø–æ–¥–æ—à—ë–ª ‚îÇ ‚îÇ ‚óã –ù–µ –ø–æ–¥–æ—à—ë–ª ‚îÇ ‚îÇ ‚óã –ù–µ –ø–æ–¥–æ—à—ë–ª ‚îÇ ‚îÇ ‚óã –ù–µ –ø–æ–¥–æ—à—ë–ª ‚îÇ       ‚îÇ
‚îÇ  ‚îÇ [–û—Ü–µ–Ω–∏—Ç—å]    ‚îÇ ‚îÇ [–û—Ü–µ–Ω–∏—Ç—å]    ‚îÇ ‚îÇ [–û—Ü–µ–Ω–∏—Ç—å]    ‚îÇ ‚îÇ [–û—Ü–µ–Ω–∏—Ç—å]    ‚îÇ       ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò       ‚îÇ
‚îÇ                                                                             ‚îÇ
‚îÇ  –ü–æ—á–µ–º—É —ç—Ç–∏ —Ç–æ–≤–∞—Ä—ã —Ä–µ–∫–æ–º–µ–Ω–¥–æ–≤–∞–Ω—ã:                                          ‚îÇ
‚îÇ  ‚Ä¢ –ì—Ä—É–Ω—Ç CERESIT ‚Äî –∫–∞—Ç–µ–≥–æ—Ä–∏—è "–ì—Ä—É–Ω—Ç–æ–≤–∫–∏", 94% –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –æ–¥–æ–±—Ä–∏–ª–∏       ‚îÇ
‚îÇ  ‚Ä¢ –®–ø–∞—Ç–µ–ª—å ‚Äî –∫–∞—Ç–µ–≥–æ—Ä–∏—è "–ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã –¥–ª—è —à—Ç—É–∫–∞—Ç—É—Ä–∫–∏", —á–∞—Å—Ç–æ –ø–æ–∫—É–ø–∞—é—Ç –≤–º–µ—Å—Ç–µ ‚îÇ
‚îÇ  ‚Ä¢ –ü—Ä–∞–≤–∏–ª–æ ‚Äî –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –¥–ª—è –≤—ã—Ä–∞–≤–Ω–∏–≤–∞–Ω–∏—è —à—Ç—É–∫–∞—Ç—É—Ä–∫–∏                        ‚îÇ
‚îÇ                                                                             ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

### –≠–ª–µ–º–µ–Ω—Ç—ã UI:
- **–ë–ª–æ–∫ "–°–æ–ø—É—Ç—Å—Ç–≤—É—é—â–∏–µ —Ç–æ–≤–∞—Ä—ã"** ‚Äî –ø–æ–¥ –æ—Å–Ω–æ–≤–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π –æ —Ç–æ–≤–∞—Ä–µ
- **–ö–∞—Ä—Ç–æ—á–∫–∏ —Ç–æ–≤–∞—Ä–æ–≤** ‚Äî –ø–µ—Ä–≤—ã–µ 4-5 –∏–∑ 20, –∫–Ω–æ–ø–∫–∞ "–ü–æ–∫–∞–∑–∞—Ç—å –≤—Å–µ"
- **–†–µ–π—Ç–∏–Ω–≥ —Å—Ö–æ–∂–µ—Å—Ç–∏** ‚Äî –≤–∏–∑—É–∞–ª—å–Ω–∞—è —à–∫–∞–ª–∞ + –ø—Ä–æ—Ü–µ–Ω—Ç
- **Radiobutton "–ü–æ–¥–æ—à—ë–ª / –ù–µ –ø–æ–¥–æ—à—ë–ª"** ‚Äî –¥–ª—è –æ—Ü–µ–Ω–∫–∏ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏
- **–ö–Ω–æ–ø–∫–∞ "–û—Ü–µ–Ω–∏—Ç—å"** ‚Äî –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Ñ–∏–¥–±–µ–∫
- **–ë–ª–æ–∫ "–ü–æ—á–µ–º—É —Ä–µ–∫–æ–º–µ–Ω–¥–æ–≤–∞–Ω—ã"** ‚Äî –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏–∑–Ω–∞–∫–æ–≤

---

### API: GET /recommendations/{product_id}

**–ó–∞–ø—Ä–æ—Å:**
```
GET /recommendations/9011800178?limit=20
```

**–û—Ç–≤–µ—Ç:**
```json
{
  "product_id": 9011800178,
  "product_name": "–®—Ç—É–∫–∞—Ç—É—Ä–∫–∞ KNAUF –†–æ—Ç–±–∞–Ω–¥ 30–∫–≥",
  "detected_scenario": {
    "id": "walls",
    "name": "–í—ã—Ä–∞–≤–Ω–∏–≤–∞–Ω–∏–µ —Å—Ç–µ–Ω"
  },
  "recommendations": [
    {
      "product": {
        "id": 1001319777,
        "name": "–≥—Ä—É–Ω—Ç –∞–∫—Ä–∏–ª–æ–≤—ã–π CERESIT CT17 Pro —É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–π 10–ª",
        "price": 890,
        "picture": "...",
        "category_name": "–ì—Ä—É–Ω—Ç–æ–≤–∫–∏"
      },
      "score": 0.94,
      "rank": 1,
      "match_reasons": [
        {"type": "category", "text": "–ö–∞—Ç–µ–≥–æ—Ä–∏—è: –ì—Ä—É–Ω—Ç–æ–≤–∫–∏ –¥–ª—è —à—Ç—É–∫–∞—Ç—É—Ä–∫–∏"},
        {"type": "feedback", "text": "94% –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –æ–¥–æ–±—Ä–∏–ª–∏"},
        {"type": "semantic", "text": "–°–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫–∞—è –±–ª–∏–∑–æ—Å—Ç—å: 0.87"}
      ]
    },
    {
      "product": {
        "id": 1001439960,
        "name": "—à–ø–∞—Ç–µ–ª—å —Ñ–∞—Å–∞–¥–Ω—ã–π TOOLBERG 350–º–º",
        "price": 320,
        "picture": "...",
        "category_name": "–®–ø–∞—Ç–µ–ª–∏"
      },
      "score": 0.87,
      "rank": 2,
      "match_reasons": [
        {"type": "category", "text": "–ö–∞—Ç–µ–≥–æ—Ä–∏—è: –ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã –¥–ª—è —à—Ç—É–∫–∞—Ç—É—Ä–∫–∏"},
        {"type": "feedback", "text": "87% –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –æ–¥–æ–±—Ä–∏–ª–∏"},
        {"type": "bought_together", "text": "–ß–∞—Å—Ç–æ –ø–æ–∫—É–ø–∞—é—Ç –≤–º–µ—Å—Ç–µ"}
      ]
    }
    // ... –µ—â—ë 18 —Ç–æ–≤–∞—Ä–æ–≤
  ],
  "total_count": 20
}
```

---

### –ê–ª–≥–æ—Ä–∏—Ç–º —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–π –¥–ª—è —Ç–æ–≤–∞—Ä–∞

```python
def get_product_recommendations(product_id: int, limit: int = 20) -> list[Recommendation]:
    """
    –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç 20 —Å–æ–ø—É—Ç—Å—Ç–≤—É—é—â–∏—Ö —Ç–æ–≤–∞—Ä–æ–≤ –¥–ª—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ —Ç–æ–≤–∞—Ä–∞.
    –°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—é: GET /recommendations/{product_id}
    """
    # 1. –ü–æ–ª—É—á–∞–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ —Ç–æ–≤–∞—Ä–µ
    product = get_product_by_id(product_id)
    product_embedding = get_embedding(product_id)

    # 2. –û–ø—Ä–µ–¥–µ–ª—è–µ–º –∫ –∫–∞–∫–æ–º—É —Å—Ü–µ–Ω–∞—Ä–∏—é –æ—Ç–Ω–æ—Å–∏—Ç—Å—è —Ç–æ–≤–∞—Ä
    scenario = detect_scenario_for_product(product)
    # –ù–∞–ø—Ä–∏–º–µ—Ä: —à—Ç—É–∫–∞—Ç—É—Ä–∫–∞ ‚Üí "–í—ã—Ä–∞–≤–Ω–∏–≤–∞–Ω–∏–µ —Å—Ç–µ–Ω"

    # 3. –ü–æ–ª—É—á–∞–µ–º –í–°–ï –≥—Ä—É–ø–ø—ã —Å—Ü–µ–Ω–∞—Ä–∏—è –ö–†–û–ú–ï –≥—Ä—É–ø–ø—ã –æ—Å–Ω–æ–≤–Ω–æ–≥–æ —Ç–æ–≤–∞—Ä–∞
    related_groups = [
        group for group in scenario.groups
        if product.category_id not in group.category_ids
    ]

    # 4. –î–ª—è –∫–∞–∂–¥–æ–π –≥—Ä—É–ø–ø—ã —Å–æ–±–∏—Ä–∞–µ–º –∫–∞–Ω–¥–∏–¥–∞—Ç–æ–≤
    all_candidates = []

    for group in related_groups:
        # –í—Å–µ —Ç–æ–≤–∞—Ä—ã –∏–∑ –∫–∞—Ç–µ–≥–æ—Ä–∏–π –≥—Ä—É–ø–ø—ã
        group_products = get_products_by_categories(group.category_ids)

        for candidate in group_products:
            # ML-—Å–∫–æ—Ä–∏–Ω–≥
            score = calculate_product_score(
                main_product=product,
                candidate=candidate,
                scenario=scenario,
                group=group,
            )

            all_candidates.append({
                "product": candidate,
                "score": score,
                "group_name": group.name,
                "match_reasons": build_match_reasons(product, candidate, score),
            })

    # 5. –°–æ—Ä—Ç–∏—Ä—É–µ–º –ø–æ —Å–∫–æ—Ä—É –∏ –±–µ—Ä—ë–º —Ç–æ–ø-20
    all_candidates.sort(key=lambda x: x["score"], reverse=True)
    return all_candidates[:limit]


def calculate_product_score(main_product, candidate, scenario, group) -> float:
    """
    –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç —Ä–µ–π—Ç–∏–Ω–≥ —Å—Ö–æ–∂–µ—Å—Ç–∏ –¥–ª—è –ø–∞—Ä—ã —Ç–æ–≤–∞—Ä–æ–≤.
    """
    score = 0.5  # –±–∞–∑–æ–≤—ã–π

    # === –°–ï–ú–ê–ù–¢–ò–ß–ï–°–ö–ê–Ø –ë–õ–ò–ó–û–°–¢–¨ ===
    main_embedding = get_embedding(main_product.id)
    candidate_embedding = get_embedding(candidate.id)
    similarity = cosine_similarity(main_embedding, candidate_embedding)
    score += similarity * 0.3  # –¥–æ +0.3

    # === –§–ò–î–ë–ï–ö: –¥–ª—è –ø–∞—Ä—ã (main_product, candidate) ===
    pair_stats = get_pair_feedback_stats(main_product.id, candidate.id)
    if pair_stats.total > 0:
        approval_rate = (pair_stats.positive + 1) / (pair_stats.total + 2)
        score += (approval_rate - 0.5) * 0.4  # –æ—Ç -0.2 –¥–æ +0.2

    # === –§–ò–î–ë–ï–ö: –¥–ª—è —Ç–æ–≤–∞—Ä–∞ –≤ —Å—Ü–µ–Ω–∞—Ä–∏–∏ ===
    scenario_stats = get_scenario_feedback_stats(scenario.id, candidate.id)
    if scenario_stats.total > 0:
        approval_rate = (scenario_stats.positive + 1) / (scenario_stats.total + 2)
        score += (approval_rate - 0.5) * 0.2  # –æ—Ç -0.1 –¥–æ +0.1

    # === –°–ö–ò–î–ö–ê ===
    if candidate.discount_price:
        discount_percent = (candidate.price - candidate.discount_price) / candidate.price
        score += discount_percent * 0.1  # –¥–æ +0.1

    return min(max(score, 0), 1)  # –Ω–æ—Ä–º–∞–ª–∏–∑—É–µ–º 0-1


def build_match_reasons(main_product, candidate, score) -> list[dict]:
    """
    –§–æ—Ä–º–∏—Ä—É–µ—Ç —Å–ø–∏—Å–æ–∫ –ø—Ä–∏—á–∏–Ω –ø–æ—á–µ–º—É —Ç–æ–≤–∞—Ä —Ä–µ–∫–æ–º–µ–Ω–¥–æ–≤–∞–Ω.
    –î–ª—è –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏–∏ –≤ UI.
    """
    reasons = []

    # –ö–∞—Ç–µ–≥–æ—Ä–∏—è
    reasons.append({
        "type": "category",
        "text": f"–ö–∞—Ç–µ–≥–æ—Ä–∏—è: {candidate.category_name}",
        "icon": "folder"
    })

    # –§–∏–¥–±–µ–∫
    pair_stats = get_pair_feedback_stats(main_product.id, candidate.id)
    if pair_stats.total > 0:
        approval = int((pair_stats.positive / pair_stats.total) * 100)
        reasons.append({
            "type": "feedback",
            "text": f"{approval}% –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –æ–¥–æ–±—Ä–∏–ª–∏",
            "icon": "thumbs-up"
        })

    # –°–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫–∞—è –±–ª–∏–∑–æ—Å—Ç—å
    similarity = get_semantic_similarity(main_product.id, candidate.id)
    if similarity > 0.7:
        reasons.append({
            "type": "semantic",
            "text": f"–°–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫–∞—è –±–ª–∏–∑–æ—Å—Ç—å: {similarity:.2f}",
            "icon": "brain"
        })

    return reasons
```

---

### –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Å—Ü–µ–Ω–∞—Ä–∏—è –¥–ª—è —Ç–æ–≤–∞—Ä–∞

```python
def detect_scenario_for_product(product: Product) -> Scenario:
    """
    –û–ø—Ä–µ–¥–µ–ª—è–µ—Ç –∫ –∫–∞–∫–æ–º—É —Å—Ü–µ–Ω–∞—Ä–∏—é –æ—Ç–Ω–æ—Å–∏—Ç—Å—è —Ç–æ–≤–∞—Ä –ø–æ –µ–≥–æ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏.
    """
    for scenario in get_all_scenarios():
        for group in scenario.groups:
            if product.category_id in group.category_ids:
                return scenario

    # –ï—Å–ª–∏ –Ω–µ –Ω–∞—à–ª–∏ ‚Äî –≤–æ–∑–≤—Ä–∞—â–∞–µ–º –¥–µ—Ñ–æ–ª—Ç–Ω—ã–π
    return get_default_scenario()
```

**–ü—Ä–∏–º–µ—Ä—ã:**
| –¢–æ–≤–∞—Ä | –ö–∞—Ç–µ–≥–æ—Ä–∏—è | –û–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω—ã–π —Å—Ü–µ–Ω–∞—Ä–∏–π |
|-------|-----------|----------------------|
| –®—Ç—É–∫–∞—Ç—É—Ä–∫–∞ KNAUF –†–æ—Ç–±–∞–Ω–¥ | –®—Ç—É–∫–∞—Ç—É—Ä–∫–∏ | –í—ã—Ä–∞–≤–Ω–∏–≤–∞–Ω–∏–µ —Å—Ç–µ–Ω |
| –†–æ–≤–Ω–∏—Ç–µ–ª—å PLITONIT | –°–º–µ—Å–∏ –¥–ª—è –ø–æ–ª–∞ | –ú–æ–Ω—Ç–∞–∂ –Ω–∞–ª–∏–≤–Ω–æ–≥–æ –ø–æ–ª–∞ |
| –ì–∞–∑–æ–±–ª–æ–∫ –õ–°–† | –ì–∞–∑–æ–±–ª–æ–∫–∏ | –ú–æ–Ω—Ç–∞–∂ –ø–µ—Ä–µ–≥–æ—Ä–æ–¥–æ–∫ |

---

### POST /feedback –¥–ª—è —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–π —Ç–æ–≤–∞—Ä–∞

**–ó–∞–ø—Ä–æ—Å:**
```json
POST /feedback
{
  "main_product_id": 9011800178,
  "recommended_product_id": 1001319777,
  "feedback": "positive",
  "context": "product_page"
}
```

**–ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç:**
1. –°–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤ `product_pair_feedback` (—Ñ–∏–¥–±–µ–∫ –¥–ª—è –ø–∞—Ä—ã —Ç–æ–≤–∞—Ä–æ–≤)
2. –û–±–Ω–æ–≤–ª—è–µ—Ç—Å—è `pair_feedback_stats` (—Å—á—ë—Ç—á–∏–∫–∏ –¥–ª—è –ø–∞—Ä—ã)
3. –¢–∞–∫–∂–µ –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è `scenario_feedback_stats` (–¥–ª—è —Å—Ü–µ–Ω–∞—Ä–∏—è —Ç–æ–≤–∞—Ä–∞)

---

### –¢–∞–±–ª–∏—Ü—ã –¥–ª—è —Ñ–∏–¥–±–µ–∫–∞ –ø–æ —Ç–æ–≤–∞—Ä–∞–º

```sql
-- –°—ã—Ä–æ–π —Ñ–∏–¥–±–µ–∫ –¥–ª—è –ø–∞—Ä —Ç–æ–≤–∞—Ä–æ–≤
CREATE TABLE product_pair_feedback (
    id SERIAL PRIMARY KEY,
    user_id INT,
    main_product_id INT NOT NULL,
    recommended_product_id INT NOT NULL,
    feedback_type VARCHAR(20) NOT NULL, -- 'positive' / 'negative'
    context VARCHAR(50), -- 'product_page' / 'scenario_page' / 'cart'
    created_at TIMESTAMP DEFAULT NOW()
);

-- –ê–≥—Ä–µ–≥–∏—Ä–æ–≤–∞–Ω–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –¥–ª—è –ø–∞—Ä
CREATE TABLE pair_feedback_stats (
    main_product_id INT NOT NULL,
    recommended_product_id INT NOT NULL,
    positive_count INT DEFAULT 0,
    negative_count INT DEFAULT 0,
    updated_at TIMESTAMP DEFAULT NOW(),
    PRIMARY KEY (main_product_id, recommended_product_id)
);

CREATE INDEX idx_pair_stats_main ON pair_feedback_stats(main_product_id);
```

---

## –¢–∏–ø 2: –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ —Å—Ü–µ–Ω–∞—Ä–∏—é

### –ö–æ–Ω—Ü–µ–ø—Ü–∏—è

–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –Ω–∞ –≥–ª–∞–≤–Ω–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü–µ –æ—Å–Ω–æ–≤–∞–Ω—ã –Ω–∞ **—Å—Ü–µ–Ω–∞—Ä–∏—è—Ö —Ä–µ–º–æ–Ω—Ç–∞** (—ç—Ç–∞–ø White Box).
–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–∏–¥–∏—Ç —á—Ç–æ –µ–º—É –Ω—É–∂–Ω–æ –¥–æ–∫—É–ø–∏—Ç—å –¥–ª—è –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –≤—ã–±—Ä–∞–Ω–Ω–æ–≥–æ —Å—Ü–µ–Ω–∞—Ä–∏—è.

### –ö–ª—é—á–µ–≤–æ–π –ø—Ä–∏–Ω—Ü–∏–ø: –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–π –ø–æ–¥–±–æ—Ä + –û–±—É—á–µ–Ω–∏–µ –Ω–∞ —Ñ–∏–¥–±–µ–∫–µ

**–°–∏—Å—Ç–µ–º–∞ –ù–ï –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –∑–∞—Ö–∞—Ä–¥–∫–æ–∂–µ–Ω–Ω—ã–µ —Å–ø–∏—Å–∫–∏ —Ç–æ–≤–∞—Ä–æ–≤.**

–î–ª—è –∫–∞–∂–¥–æ–π –≥—Ä—É–ø–ø—ã —Ç–æ–≤–∞—Ä–æ–≤ (–ì—Ä—É–Ω—Ç—ã, –ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã, –Å–º–∫–æ—Å—Ç–∏ –∏ —Ç.–¥.) ML-–º–æ–¥–µ–ª—å:
1. –ê–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç –í–°–ï —Ç–æ–≤–∞—Ä—ã –∏–∑ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏—Ö –∫–∞—Ç–µ–≥–æ—Ä–∏–π
2. –ü–æ–¥–±–∏—Ä–∞–µ—Ç –Ω–µ—Å–∫–æ–ª—å–∫–æ –ª—É—á—à–∏—Ö –∫–∞–Ω–¥–∏–¥–∞—Ç–æ–≤ –Ω–∞ –æ—Å–Ω–æ–≤–µ —ç–º–±–µ–¥–¥–∏–Ω–≥–æ–≤
3. –†–∞–Ω–∂–∏—Ä—É–µ—Ç –∏—Ö —Å —É—á—ë—Ç–æ–º –Ω–∞–∫–æ–ø–ª–µ–Ω–Ω–æ–≥–æ —Ñ–∏–¥–±–µ–∫–∞
4. –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é —Ç–æ–ø —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–π

**–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–ª–∏—è–µ—Ç –Ω–∞ —Å–∏—Å—Ç–µ–º—É:**
- üëç –õ–∞–π–∫ ‚Äî —Ç–æ–≤–∞—Ä –ø–æ–ª—É—á–∞–µ—Ç +1 –∫ —Ä–µ–π—Ç–∏–Ω–≥—É, —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–Ω–µ–µ –¥–ª—è –±—É–¥—É—â–∏—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- üëé –î–∏–∑–ª–∞–π–∫ ‚Äî —Ç–æ–≤–∞—Ä –ø–æ–ª—É—á–∞–µ—Ç -1, –æ–ø—É—Å–∫–∞–µ—Ç—Å—è –≤ –≤—ã–¥–∞—á–µ

–¢–∞–∫ —Å–∏—Å—Ç–µ–º–∞ **–æ–±—É—á–∞–µ—Ç—Å—è** –∏ —Å–æ –≤—Ä–µ–º–µ–Ω–µ–º –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –≤—Å—ë –±–æ–ª–µ–µ —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—ã–µ —Ç–æ–≤–∞—Ä—ã.

---

## UI –Ω–∞ –≥–ª–∞–≤–Ω–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü–µ

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  ‚Üê  –ú–æ–Ω—Ç–∞–∂ –Ω–∞–ª–∏–≤–Ω–æ–≥–æ –ø–æ–ª–∞  ‚Üí                     [–í—Å–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏] ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ                                                                 ‚îÇ
‚îÇ  –î–ª—è –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –Ω–∞–±–æ—Ä–∞:                                        ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê            ‚îÇ
‚îÇ  ‚îÇ –ì—Ä—É–Ω—Ç ‚îÇ ‚îÇ –í–∞–ª–∏–∫ ‚îÇ ‚îÇ –í–µ–¥—Ä–æ ‚îÇ ‚îÇ–£—Ä–æ–≤–µ–Ω—å‚îÇ ‚îÇ–ú–∏–∫—Å–µ—Ä ‚îÇ            ‚îÇ
‚îÇ  ‚îÇ CERESIT‚îÇ ‚îÇ–∏–≥–æ–ª—å—á.‚îÇ ‚îÇ 90–ª   ‚îÇ ‚îÇ1000–º–º ‚îÇ ‚îÇ–Ω–∞—Å–∞–¥–∫–∞‚îÇ            ‚îÇ
‚îÇ  ‚îÇ 890 ‚ÇΩ ‚îÇ ‚îÇ 450 ‚ÇΩ ‚îÇ ‚îÇ 320 ‚ÇΩ ‚îÇ ‚îÇ 670 ‚ÇΩ ‚îÇ ‚îÇ 290 ‚ÇΩ ‚îÇ            ‚îÇ
‚îÇ  ‚îÇ[–í –∫–æ—Ä–∑]‚îÇ ‚îÇ[–í –∫–æ—Ä–∑]‚îÇ ‚îÇ  ‚úì   ‚îÇ ‚îÇ[–í –∫–æ—Ä–∑]‚îÇ ‚îÇ[–í –∫–æ—Ä–∑]‚îÇ            ‚îÇ
‚îÇ  ‚îÇ üëç üëé ‚îÇ ‚îÇ üëç üëé ‚îÇ ‚îÇ      ‚îÇ ‚îÇ üëç üëé ‚îÇ ‚îÇ üëç üëé ‚îÇ            ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò            ‚îÇ
‚îÇ                                                                 ‚îÇ
‚îÇ  ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ  ‚îÇ
‚îÇ  –ü—Ä–æ–≥—Ä–µ—Å—Å —Å—Ü–µ–Ω–∞—Ä–∏—è: ‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë 3 –∏–∑ 8 –∫–∞—Ç–µ–≥–æ—Ä–∏–π          ‚îÇ
‚îÇ                                                                 ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

### –≠–ª–µ–º–µ–Ω—Ç—ã:
- **–°—Ç—Ä–µ–ª–∫–∏ ‚Üê‚Üí** ‚Äî –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –º–µ–∂–¥—É —Å—Ü–µ–Ω–∞—Ä–∏—è–º–∏
- **–ù–∞–∑–≤–∞–Ω–∏–µ —Å—Ü–µ–Ω–∞—Ä–∏—è** ‚Äî –∫–ª–∏–∫–∞–±–µ–ª—å–Ω–æ–µ, –≤–µ–¥—ë—Ç –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É —Å—Ü–µ–Ω–∞—Ä–∏—è
- **[–í—Å–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏]** ‚Äî –∫–Ω–æ–ø–∫–∞ –≤ —É–≥–ª—É, –≤–µ–¥—ë—Ç –Ω–∞ `/scenarios`
- **–ö–∞—Ä—Ç–æ—á–∫–∏ —Ç–æ–≤–∞—Ä–æ–≤** ‚Äî –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ –ø–æ–¥–æ–±—Ä–∞–Ω–Ω—ã–µ ML-–º–æ–¥–µ–ª—å—é
- **üëç üëé** ‚Äî –∫–Ω–æ–ø–∫–∏ —Ñ–∏–¥–±–µ–∫–∞ –ø–æ–¥ –∫–∞–∂–¥—ã–º —Ç–æ–≤–∞—Ä–æ–º (–≤–ª–∏—è—é—Ç –Ω–∞ –±—É–¥—É—â–∏–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏)
- **‚úì** ‚Äî —Ç–æ–≤–∞—Ä —É–∂–µ –≤ –∫–æ—Ä–∑–∏–Ω–µ (–∫–Ω–æ–ø–∫–∏ —Ñ–∏–¥–±–µ–∫–∞ —Å–∫—Ä—ã—Ç—ã)
- **–ü—Ä–æ–≥—Ä–µ—Å—Å** ‚Äî —Å–∫–æ–ª—å–∫–æ –∫–∞—Ç–µ–≥–æ—Ä–∏–π –∑–∞–∫—Ä—ã—Ç–æ

---

## UI —Å—Ç—Ä–∞–Ω–∏—Ü—ã —Å—Ü–µ–Ω–∞—Ä–∏—è (/scenarios/{id})

–î–µ—Ç–∞–ª—å–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ –≥–¥–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–∏–¥–∏—Ç –í–°–ï –≥—Ä—É–ø–ø—ã —Ç–æ–≤–∞—Ä–æ–≤ –¥–ª—è —Å—Ü–µ–Ω–∞—Ä–∏—è –∏ –º–æ–∂–µ—Ç –æ—Ü–µ–Ω–∏–≤–∞—Ç—å —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏:

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  ‚Üê –ù–∞–∑–∞–¥ –∫ —Å—Ü–µ–Ω–∞—Ä–∏—è–º                                                    ‚îÇ
‚îÇ                                                                         ‚îÇ
‚îÇ  –ú–û–ù–¢–ê–ñ –ù–ê–õ–ò–í–ù–û–ì–û –ü–û–õ–ê                                                 ‚îÇ
‚îÇ  –ü—Ä–æ–≥—Ä–µ—Å—Å: ‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë 4 –∏–∑ 8 –≥—Ä—É–ø–ø                           ‚îÇ
‚îÇ                                                                         ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ                                                                         ‚îÇ
‚îÇ  –û–°–ù–û–í–ê (–°–º–µ—Å–∏ –¥–ª—è –≤—ã—Ä–∞–≤–Ω–∏–≤–∞–Ω–∏—è)                              ‚úì –ì–æ—Ç–æ–≤–æ ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê   ‚îÇ
‚îÇ  ‚îÇ –í –∫–æ—Ä–∑–∏–Ω–µ: –†–æ–≤–Ω–∏—Ç–µ–ª—å PLITONIT Universal 20–∫–≥                    ‚îÇ   ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò   ‚îÇ
‚îÇ                                                                         ‚îÇ
‚îÇ  –ì–†–£–ù–¢–´                                                      ‚ö† –ù—É–∂–Ω–æ   ‚îÇ
‚îÇ  –í—ã–±–µ—Ä–∏—Ç–µ –ø–æ–¥—Ö–æ–¥—è—â–∏–π —Ç–æ–≤–∞—Ä:                                            ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê                            ‚îÇ
‚îÇ  ‚îÇ –ì—Ä—É–Ω—Ç     ‚îÇ ‚îÇ –ì—Ä—É–Ω—Ç     ‚îÇ ‚îÇ –ì—Ä—É–Ω—Ç     ‚îÇ                            ‚îÇ
‚îÇ  ‚îÇ CERESIT   ‚îÇ ‚îÇ TIKKURILA ‚îÇ ‚îÇ KNAUF     ‚îÇ                            ‚îÇ
‚îÇ  ‚îÇ CT17 Pro  ‚îÇ ‚îÇ Euro      ‚îÇ ‚îÇ Tiefengr. ‚îÇ                            ‚îÇ
‚îÇ  ‚îÇ           ‚îÇ ‚îÇ           ‚îÇ ‚îÇ           ‚îÇ                            ‚îÇ
‚îÇ  ‚îÇ 890 ‚ÇΩ     ‚îÇ ‚îÇ 650 ‚ÇΩ     ‚îÇ ‚îÇ 720 ‚ÇΩ     ‚îÇ                            ‚îÇ
‚îÇ  ‚îÇ           ‚îÇ ‚îÇ           ‚îÇ ‚îÇ           ‚îÇ                            ‚îÇ
‚îÇ  ‚îÇ [–í –∫–æ—Ä–∑.] ‚îÇ ‚îÇ [–í –∫–æ—Ä–∑.] ‚îÇ ‚îÇ [–í –∫–æ—Ä–∑.] ‚îÇ                            ‚îÇ
‚îÇ  ‚îÇ           ‚îÇ ‚îÇ           ‚îÇ ‚îÇ           ‚îÇ                            ‚îÇ
‚îÇ  ‚îÇ ‚óã –ü–æ–¥–æ—à—ë–ª ‚îÇ ‚îÇ ‚óã –ü–æ–¥–æ—à—ë–ª ‚îÇ ‚îÇ ‚óã –ü–æ–¥–æ—à—ë–ª ‚îÇ                            ‚îÇ
‚îÇ  ‚îÇ ‚óã –ù–µ –ø–æ–¥–æ—à‚îÇ ‚îÇ ‚óã –ù–µ –ø–æ–¥–æ—à‚îÇ ‚îÇ ‚óã –ù–µ –ø–æ–¥–æ—à‚îÇ                            ‚îÇ
‚îÇ  ‚îÇ [–û—Ü–µ–Ω–∏—Ç—å] ‚îÇ ‚îÇ [–û—Ü–µ–Ω–∏—Ç—å] ‚îÇ ‚îÇ [–û—Ü–µ–Ω–∏—Ç—å] ‚îÇ                            ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò                            ‚îÇ
‚îÇ                                                                         ‚îÇ
‚îÇ  –Å–ú–ö–û–°–¢–ò (–í—ë–¥—Ä–∞)                                             ‚ö† –ù—É–∂–Ω–æ   ‚îÇ
‚îÇ  –í—ã–±–µ—Ä–∏—Ç–µ –ø–æ–¥—Ö–æ–¥—è—â–∏–π —Ç–æ–≤–∞—Ä:                                            ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê                                          ‚îÇ
‚îÇ  ‚îÇ –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä ‚îÇ ‚îÇ –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä ‚îÇ                                          ‚îÇ
‚îÇ  ‚îÇ 90–ª       ‚îÇ ‚îÇ 60–ª       ‚îÇ                                          ‚îÇ
‚îÇ  ‚îÇ 320 ‚ÇΩ     ‚îÇ ‚îÇ 250 ‚ÇΩ     ‚îÇ                                          ‚îÇ
‚îÇ  ‚îÇ [–í –∫–æ—Ä–∑.] ‚îÇ ‚îÇ [–í –∫–æ—Ä–∑.] ‚îÇ                                          ‚îÇ
‚îÇ  ‚îÇ ‚óã –ü–æ–¥–æ—à—ë–ª ‚îÇ ‚îÇ ‚óã –ü–æ–¥–æ—à—ë–ª ‚îÇ                                          ‚îÇ
‚îÇ  ‚îÇ ‚óã –ù–µ –ø–æ–¥–æ—à‚îÇ ‚îÇ ‚óã –ù–µ –ø–æ–¥–æ—à‚îÇ                                          ‚îÇ
‚îÇ  ‚îÇ [–û—Ü–µ–Ω–∏—Ç—å] ‚îÇ ‚îÇ [–û—Ü–µ–Ω–∏—Ç—å] ‚îÇ                                          ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò                                          ‚îÇ
‚îÇ                                                                         ‚îÇ
‚îÇ  ... –æ—Å—Ç–∞–ª—å–Ω—ã–µ –≥—Ä—É–ø–ø—ã ...                                              ‚îÇ
‚îÇ                                                                         ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

### –≠–ª–µ–º–µ–Ω—Ç—ã UI:

- **–ì—Ä—É–ø–ø—ã —Ç–æ–≤–∞—Ä–æ–≤** ‚Äî –∫–∞–∂–¥–∞—è –≥—Ä—É–ø–ø–∞ (–ì—Ä—É–Ω—Ç—ã, –Å–º–∫–æ—Å—Ç–∏, –ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã) –ø–æ–∫–∞–∑–∞–Ω–∞ –æ—Ç–¥–µ–ª—å–Ω—ã–º –±–ª–æ–∫–æ–º
- **–°—Ç–∞—Ç—É—Å –≥—Ä—É–ø–ø—ã**: ‚úì –ì–æ—Ç–æ–≤–æ (–µ—Å—Ç—å –≤ –∫–æ—Ä–∑–∏–Ω–µ) / ‚ö† –ù—É–∂–Ω–æ (–Ω–µ—Ç –≤ –∫–æ—Ä–∑–∏–Ω–µ)
- **–ö–∞—Ä—Ç–æ—á–∫–∏ —Ç–æ–≤–∞—Ä–æ–≤** ‚Äî ML –ø–æ–¥–±–∏—Ä–∞–µ—Ç —Ç–æ–ø-3 –¥–ª—è –∫–∞–∂–¥–æ–π –≥—Ä—É–ø–ø—ã
- **Radiobutton "–ü–æ–¥–æ—à—ë–ª / –ù–µ –ø–æ–¥–æ—à—ë–ª"** ‚Äî –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤—ã–±–∏—Ä–∞–µ—Ç –æ–¥–∏–Ω –≤–∞—Ä–∏–∞–Ω—Ç
- **–ö–Ω–æ–ø–∫–∞ "–û—Ü–µ–Ω–∏—Ç—å"** ‚Äî –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Ñ–∏–¥–±–µ–∫, –≤–ª–∏—è–µ—Ç –Ω–∞ –±—É–¥—É—â–∏–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏
- **–ö–Ω–æ–ø–∫–∞ "–í –∫–æ—Ä–∑–∏–Ω—É"** ‚Äî –¥–æ–±–∞–≤–ª—è–µ—Ç —Ç–æ–≤–∞—Ä

### –ü–æ—Ç–æ–∫ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è:

1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç —Å—Ç—Ä–∞–Ω–∏—Ü—É —Å—Ü–µ–Ω–∞—Ä–∏—è
2. –í–∏–¥–∏—Ç –≤—Å–µ –≥—Ä—É–ø–ø—ã —Ç–æ–≤–∞—Ä–æ–≤ —Å —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è–º–∏ (–ø–æ–¥–æ–±—Ä–∞–Ω—ã ML)
3. –î–ª—è –∫–∞–∂–¥–æ–≥–æ —Ç–æ–≤–∞—Ä–∞ –º–æ–∂–µ—Ç:
   - **–î–æ–±–∞–≤–∏—Ç—å –≤ –∫–æ—Ä–∑–∏–Ω—É** ‚Äî –≥—Ä—É–ø–ø–∞ —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è "–ì–æ—Ç–æ–≤–æ"
   - **–û—Ü–µ–Ω–∏—Ç—å** ‚Äî –≤—ã–±—Ä–∞—Ç—å "–ü–æ–¥–æ—à—ë–ª" –∏–ª–∏ "–ù–µ –ø–æ–¥–æ—à—ë–ª" –∏ –Ω–∞–∂–∞—Ç—å –∫–Ω–æ–ø–∫—É
4. –ü–æ—Å–ª–µ –æ—Ü–µ–Ω–∫–∏:
   - –§–∏–¥–±–µ–∫ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤ –ë–î
   - –†–µ–π—Ç–∏–Ω–≥ —Ç–æ–≤–∞—Ä–∞ –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è
   - –°–ª–µ–¥—É—é—â–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —É–≤–∏–¥–∏—Ç –±–æ–ª–µ–µ —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—ã–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

---

## –õ–æ–≥–∏–∫–∞ –∑–∞–ø–æ–ª–Ω–µ–Ω–∏—è —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–π

### –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 1: –ù–µ–¥–æ—Å—Ç–∞—é—â–∏–µ —Ç–æ–≤–∞—Ä—ã
–¢–æ–≤–∞—Ä—ã –∏–∑ –∫–∞—Ç–µ–≥–æ—Ä–∏–π —Å—Ü–µ–Ω–∞—Ä–∏—è, –∫–æ—Ç–æ—Ä—ã—Ö –Ω–µ—Ç –≤ –∫–æ—Ä–∑–∏–Ω–µ.

```
–°—Ü–µ–Ω–∞—Ä–∏–π "–ù–∞–ª–∏–≤–Ω–æ–π –ø–æ–ª" —Ç—Ä–µ–±—É–µ—Ç –∫–∞—Ç–µ–≥–æ—Ä–∏–∏:
- –°–º–µ—Å–∏ –¥–ª—è –≤—ã—Ä–∞–≤–Ω–∏–≤–∞–Ω–∏—è –ø–æ–ª–æ–≤ ‚úì (–µ—Å—Ç—å –≤ –∫–æ—Ä–∑–∏–Ω–µ)
- –ì—Ä—É–Ω—Ç—ã ‚úó ‚Üí —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ–º –≥—Ä—É–Ω—Ç
- –ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã (–≤–∞–ª–∏–∫–∏) ‚úó ‚Üí —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ–º –≤–∞–ª–∏–∫
- –Å–º–∫–æ—Å—Ç–∏ ‚úó ‚Üí —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ–º –≤–µ–¥—Ä–æ
- –ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã (–º–∏–∫—Å–µ—Ä) ‚úó ‚Üí —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ–º –Ω–∞—Å–∞–¥–∫—É
```

### –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 2: –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤—ã (–µ—Å–ª–∏ –≤—Å—ë –µ—Å—Ç—å)
–ï—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —É–∂–µ —Å–æ–±—Ä–∞–ª –≤–µ—Å—å –Ω–∞–±–æ—Ä –¥–ª—è —Å—Ü–µ–Ω–∞—Ä–∏—è:
- –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–µ –±—Ä–µ–Ω–¥—ã –¥–ª—è —Ç–æ–≤–∞—Ä–æ–≤ –≤ –∫–æ—Ä–∑–∏–Ω–µ
- –î—Ä—É–≥–æ–π —Ü–µ–Ω–æ–≤–æ–π —Å–µ–≥–º–µ–Ω—Ç (–¥–µ—à–µ–≤–ª–µ/–¥–æ—Ä–æ–∂–µ)

```
–í –∫–æ—Ä–∑–∏–Ω–µ: –≥—Ä—É–Ω—Ç CERESIT 890‚ÇΩ
–ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∞: –≥—Ä—É–Ω—Ç TIKKURILA 650‚ÇΩ (-27%)
```

### –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 3: –†–∞—Å—Ö–æ–¥–Ω–∏–∫–∏
–ï—Å–ª–∏ –Ω—É–∂–Ω–æ –∑–∞–ø–æ–ª–Ω–∏—Ç—å –±–ª–æ–∫:
- –ë–æ–ª—å—à–µ —Å–º–µ—Å–∏ (—É –≤–∞—Å 1 –º–µ—à–æ–∫, –≤–æ–∑—å–º–∏—Ç–µ –µ—â—ë)
- –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ä–∞—Å—Ö–æ–¥–Ω–∏–∫–∏ (–µ—â—ë –≤–∞–ª–∏–∫, –ø–ª—ë–Ω–∫–∞)

### –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 4: –°–ª–µ–¥—É—é—â–∏–π —ç—Ç–∞–ø
–ï—Å–ª–∏ —Å—Ü–µ–Ω–∞—Ä–∏–π –ø–æ–ª–Ω–æ—Å—Ç—å—é –∑–∞–∫—Ä—ã—Ç:
- –¢–æ–≤–∞—Ä—ã –¥–ª—è —Å–ª–µ–¥—É—é—â–µ–≥–æ —ç—Ç–∞–ø–∞ —Ä–µ–º–æ–Ω—Ç–∞
- "–í—ã –≥–æ—Ç–æ–≤—ã –∫ —ç—Ç–∞–ø—É: –í—ã—Ä–∞–≤–Ω–∏–≤–∞–Ω–∏–µ —Å—Ç–µ–Ω"

---

## –°—Ü–µ–Ω–∞—Ä–∏–∏ White Box

### 1. –ú–æ–Ω—Ç–∞–∂ –Ω–∞–ª–∏–≤–Ω–æ–≥–æ –ø–æ–ª–∞
**–ö–∞—Ç–µ–≥–æ—Ä–∏–∏:**
| –ì—Ä—É–ø–ø–∞ | –ö–∞—Ç–µ–≥–æ—Ä–∏–∏ (ID –∏–ª–∏ –ø–∞—Ç—Ç–µ—Ä–Ω) | –û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ |
|--------|---------------------------|-------------|
| –û—Å–Ω–æ–≤–∞ | –°–º–µ—Å–∏ –¥–ª—è –≤—ã—Ä–∞–≤–Ω–∏–≤–∞–Ω–∏—è –ø–æ–ª–æ–≤ | –î–∞ |
| –ì—Ä—É–Ω—Ç—ã | –ì—Ä—É–Ω—Ç–æ–≤–∫–∏, –ì–∏–¥—Ä–æ–∏–∑–æ–ª—è—Ü–∏—è | –î–∞ |
| –Å–º–∫–æ—Å—Ç–∏ | –í—ë–¥—Ä–∞ —Å—Ç—Ä–æ–∏—Ç–µ–ª—å–Ω—ã–µ, –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã | –î–∞ |
| –ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç | –í–∞–ª–∏–∫–∏ –∏–≥–æ–ª—å—á–∞—Ç—ã–µ | –î–∞ |
| –ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç | –ù–∞—Å–∞–¥–∫–∏ –Ω–∞ –º–∏–∫—Å–µ—Ä | –î–∞ |
| –ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç | –£—Ä–æ–≤–Ω–∏ | –ù–µ—Ç |
| –ü–ª—ë–Ω–∫–∞ | –ü–ª—ë–Ω–∫–∞ —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è, –õ–µ–Ω—Ç–∞ –¥–µ–º–ø—Ñ–µ—Ä–Ω–∞—è | –ù–µ—Ç |
| –®—É–º–æ–∏–∑–æ–ª—è—Ü–∏—è | –ü–ª–∏—Ç—ã —Ç–µ–ø–ª–æ–∏–∑–æ–ª—è—Ü–∏–æ–Ω–Ω—ã–µ | –ù–µ—Ç |

### 2. –ú–æ–Ω—Ç–∞–∂ –ø–µ—Ä–µ–≥–æ—Ä–æ–¥–æ–∫ (–ì–ö –∏ –≥–∞–∑–æ–±–ª–æ–∫–∏)
**–ö–∞—Ç–µ–≥–æ—Ä–∏–∏:**
| –ì—Ä—É–ø–ø–∞ | –ö–∞—Ç–µ–≥–æ—Ä–∏–∏ | –û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ |
|--------|-----------|-------------|
| –û—Å–Ω–æ–≤–∞ | –ì–∞–∑–æ–±–ª–æ–∫–∏, –ì–∏–ø—Å–æ–∫–∞—Ä—Ç–æ–Ω | –î–∞ |
| –ö–ª–µ–π | –ö–ª–µ–π –¥–ª—è –≥–∞–∑–æ–±–ª–æ–∫–æ–≤, –ö–ª–µ–π –¥–ª—è –ì–ö–õ | –î–∞ |
| –ì—Ä—É–Ω—Ç—ã | –ì—Ä—É–Ω—Ç–æ–≤–∫–∏ | –î–∞ |
| –®–ø–∞—Ç–ª—ë–≤–∫–∞ | –®–ø–∞—Ç–ª—ë–≤–∫–∏ –ø–æ–ª–∏–º–µ—Ä–Ω—ã–µ | –î–∞ |
| –Å–º–∫–æ—Å—Ç–∏ | –í—ë–¥—Ä–∞ —Å—Ç—Ä–æ–∏—Ç–µ–ª—å–Ω—ã–µ | –î–∞ |
| –ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç | –ù–∞—Å–∞–¥–∫–∏ –Ω–∞ –º–∏–∫—Å–µ—Ä | –î–∞ |

### 3. –í—ã—Ä–∞–≤–Ω–∏–≤–∞–Ω–∏–µ —Å—Ç–µ–Ω
**–ö–∞—Ç–µ–≥–æ—Ä–∏–∏:**
| –ì—Ä—É–ø–ø–∞ | –ö–∞—Ç–µ–≥–æ—Ä–∏–∏ | –û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ |
|--------|-----------|-------------|
| –û—Å–Ω–æ–≤–∞ | –®—Ç—É–∫–∞—Ç—É—Ä–∫–∏ –≥–∏–ø—Å–æ–≤—ã–µ | –î–∞ |
| –ì—Ä—É–Ω—Ç—ã | –ì—Ä—É–Ω—Ç–æ–≤–∫–∏, –ë–µ—Ç–æ–Ω–∫–æ–Ω—Ç–∞–∫—Ç, –ì–∏–¥—Ä–æ–∏–∑–æ–ª—è—Ü–∏—è | –î–∞ |
| –®–ø–∞—Ç–ª—ë–≤–∫–∞ | –®–ø–∞—Ç–ª—ë–≤–∫–∏ –ø–æ–ª–∏–º–µ—Ä–Ω—ã–µ | –î–∞ |
| –Å–º–∫–æ—Å—Ç–∏ | –í—ë–¥—Ä–∞ —Å—Ç—Ä–æ–∏—Ç–µ–ª—å–Ω—ã–µ | –î–∞ |
| –ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç | –ü—Ä–∞–≤–∏–ª–∞, –®–ø–∞—Ç–µ–ª–∏ | –î–∞ |
| –ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç | –ù–∞—Å–∞–¥–∫–∏ –Ω–∞ –º–∏–∫—Å–µ—Ä | –î–∞ |
| –ê—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ | –°–µ—Ç–∫–∞, –°–µ—Ä–ø—è–Ω–∫–∞ | –ù–µ—Ç |
| –†–∞—Å—Ö–æ–¥–Ω–∏–∫–∏ | –õ–µ–Ω—Ç–∞ –º–∞–ª—è—Ä–Ω–∞—è | –ù–µ—Ç |

---

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∞–Ω–Ω—ã—Ö

### –¢–∞–±–ª–∏—Ü–∞ scenarios
```sql
CREATE TABLE scenarios (
    id VARCHAR(50) PRIMARY KEY,
    name VARCHAR(200) NOT NULL,
    description TEXT,
    stage VARCHAR(50) DEFAULT 'white_box', -- white_box, black_box, finishing
    sort_order INT DEFAULT 0
);
```

### –¢–∞–±–ª–∏—Ü–∞ scenario_categories
```sql
CREATE TABLE scenario_categories (
    id SERIAL PRIMARY KEY,
    scenario_id VARCHAR(50) REFERENCES scenarios(id),
    group_name VARCHAR(100) NOT NULL, -- "–ì—Ä—É–Ω—Ç—ã", "–ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç"
    category_pattern VARCHAR(200), -- –ø–∞—Ç—Ç–µ—Ä–Ω –¥–ª—è –ø–æ–∏—Å–∫–∞ –∫–∞—Ç–µ–≥–æ—Ä–∏–π
    category_ids INT[], -- –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ ID –∫–∞—Ç–µ–≥–æ—Ä–∏–π
    is_required BOOLEAN DEFAULT true,
    sort_order INT DEFAULT 0
);
```

### –¢–∞–±–ª–∏—Ü–∞ scenario_feedback
```sql
CREATE TABLE scenario_feedback (
    id SERIAL PRIMARY KEY,
    user_id INT,
    scenario_id VARCHAR(50),
    product_id INT,
    feedback_type VARCHAR(20), -- 'positive', 'negative'
    created_at TIMESTAMP DEFAULT NOW()
);
```

---

## API —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã

### GET /scenarios
–°–ø–∏—Å–æ–∫ –≤—Å–µ—Ö —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤.
```json
{
  "scenarios": [
    {
      "id": "floor",
      "name": "–ú–æ–Ω—Ç–∞–∂ –Ω–∞–ª–∏–≤–Ω–æ–≥–æ –ø–æ–ª–∞",
      "description": "...",
      "groups_count": 8,
      "image": "/images/scenarios/floor.jpg"
    }
  ]
}
```

### GET /scenarios/{id}
–î–µ—Ç–∞–ª–∏ —Å—Ü–µ–Ω–∞—Ä–∏—è —Å –≥—Ä—É–ø–ø–∞–º–∏ –∫–∞—Ç–µ–≥–æ—Ä–∏–π.
```json
{
  "id": "floor",
  "name": "–ú–æ–Ω—Ç–∞–∂ –Ω–∞–ª–∏–≤–Ω–æ–≥–æ –ø–æ–ª–∞",
  "groups": [
    {
      "name": "–ì—Ä—É–Ω—Ç—ã",
      "is_required": true,
      "categories": [{"id": 123, "name": "–ì—Ä—É–Ω—Ç–æ–≤–∫–∏"}]
    }
  ]
}
```

### GET /scenarios/{id}/recommendations?cart_product_ids=1,2,3
–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –¥–ª—è —Å—Ü–µ–Ω–∞—Ä–∏—è —Å —É—á—ë—Ç–æ–º –∫–æ—Ä–∑–∏–Ω—ã.
```json
{
  "scenario_id": "floor",
  "progress": {
    "completed": 3,
    "total": 8,
    "percentage": 37
  },
  "missing": [
    {
      "group": "–ì—Ä—É–Ω—Ç—ã",
      "products": [
        {"id": 101, "name": "–ì—Ä—É–Ω—Ç CERESIT", "price": 890, "score": 0.95}
      ]
    }
  ],
  "alternatives": [...],
  "extras": [...]
}
```

### POST /scenarios/{id}/feedback
–§–∏–¥–±–µ–∫ –Ω–∞ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—é –≤ —Ä–∞–º–∫–∞—Ö —Å—Ü–µ–Ω–∞—Ä–∏—è.
```json
{
  "product_id": 101,
  "feedback": "positive"
}
```

---

## –ê–ª–≥–æ—Ä–∏—Ç–º –ø–æ–¥–±–æ—Ä–∞ —Ç–æ–≤–∞—Ä–æ–≤ –≤ –≥—Ä—É–ø–ø–µ

–î–ª—è –∫–∞–∂–¥–æ–π –≥—Ä—É–ø–ø—ã —Å—Ü–µ–Ω–∞—Ä–∏—è (–Ω–∞–ø—Ä–∏–º–µ—Ä "–ì—Ä—É–Ω—Ç—ã") ML-–º–æ–¥–µ–ª—å **–¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ –∞–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç –í–°–ï —Ç–æ–≤–∞—Ä—ã** –∏–∑ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏—Ö –∫–∞—Ç–µ–≥–æ—Ä–∏–π:

### –®–∞–≥–∏ –∞–ª–≥–æ—Ä–∏—Ç–º–∞:

1. **–ù–∞–π—Ç–∏ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏** –ø–æ –ø–∞—Ç—Ç–µ—Ä–Ω—É –∏–ª–∏ ID (–Ω–∞–ø—Ä–∏–º–µ—Ä, –≤—Å–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ —Å–æ–¥–µ—Ä–∂–∞—â–∏–µ "–≥—Ä—É–Ω—Ç")
2. **–ü–æ–ª—É—á–∏—Ç—å –í–°–ï —Ç–æ–≤–∞—Ä—ã** –∏–∑ —ç—Ç–∏—Ö –∫–∞—Ç–µ–≥–æ—Ä–∏–π (–º–æ–∂–µ—Ç –±—ã—Ç—å —Å–æ—Ç–Ω–∏ —Ç–æ–≤–∞—Ä–æ–≤)
3. **ML-—Ä–∞–Ω–∂–∏—Ä–æ–≤–∞–Ω–∏–µ** –∫–∞–∂–¥–æ–≥–æ —Ç–æ–≤–∞—Ä–∞ –ø–æ —Ñ–∞–∫—Ç–æ—Ä–∞–º:
   - üß† **–°–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫–∞—è –±–ª–∏–∑–æ—Å—Ç—å** –∫ —Ç–æ–≤–∞—Ä–∞–º –≤ –∫–æ—Ä–∑–∏–Ω–µ (cosine similarity —ç–º–±–µ–¥–¥–∏–Ω–≥–æ–≤)
   - üìä **–ù–∞–∫–æ–ø–ª–µ–Ω–Ω—ã–π —Ñ–∏–¥–±–µ–∫** ‚Äî —Å–∫–æ–ª—å–∫–æ –ª–∞–π–∫–æ–≤/–¥–∏–∑–ª–∞–π–∫–æ–≤ –ø–æ–ª—É—á–∏–ª —Ç–æ–≤–∞—Ä –≤ —ç—Ç–æ–º —Å—Ü–µ–Ω–∞—Ä–∏–∏
   - üí∞ **–ù–∞–ª–∏—á–∏–µ —Å–∫–∏–¥–∫–∏** ‚Äî —Ç–æ–≤–∞—Ä—ã —Å–æ —Å–∫–∏–¥–∫–æ–π –ø–æ–ª—É—á–∞—é—Ç –±—É—Å—Ç
   - ‚≠ê **–ü–æ–ø—É–ª—è—Ä–Ω–æ—Å—Ç—å** ‚Äî –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –¥–æ–±–∞–≤–ª–µ–Ω–∏–π –≤ –∫–æ—Ä–∑–∏–Ω—É
4. **–í–µ—Ä–Ω—É—Ç—å —Ç–æ–ø-3** —Ç–æ–≤–∞—Ä–∞ –¥–ª—è –≥—Ä—É–ø–ø—ã

### –§–æ—Ä–º—É–ª–∞ —Å–∫–æ—Ä–∏–Ω–≥–∞:

```python
def get_group_recommendations(scenario_id, group, cart_products, limit=3):
    # 1. –í–°–ï —Ç–æ–≤–∞—Ä—ã –∏–∑ –∫–∞—Ç–µ–≥–æ—Ä–∏–π –≥—Ä—É–ø–ø—ã
    candidates = get_products_by_categories(group.category_ids)
    # –ú–æ–∂–µ—Ç –±—ã—Ç—å 500+ —Ç–æ–≤–∞—Ä–æ–≤ –¥–ª—è –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ "–ì—Ä—É–Ω—Ç–æ–≤–∫–∏"

    # 2. –ò—Å–∫–ª—é—á–∞–µ–º —Ç–æ —á—Ç–æ —É–∂–µ –≤ –∫–æ—Ä–∑–∏–Ω–µ
    candidates = [p for p in candidates if p.id not in cart_product_ids]

    # 3. ML-—Å–∫–æ—Ä–∏–Ω–≥ –∫–∞–∂–¥–æ–≥–æ —Ç–æ–≤–∞—Ä–∞
    for product in candidates:
        score = 0.5  # –±–∞–∑–æ–≤—ã–π —Å–∫–æ—Ä

        # === –°–ï–ú–ê–ù–¢–ò–ß–ï–°–ö–ê–Ø –ë–õ–ò–ó–û–°–¢–¨ (—ç–º–±–µ–¥–¥–∏–Ω–≥–∏) ===
        # –ù–∞—Å–∫–æ–ª—å–∫–æ —Ç–æ–≤–∞—Ä "–ø–æ—Ö–æ–∂" –Ω–∞ —Ç–æ —á—Ç–æ —É–∂–µ –≤ –∫–æ—Ä–∑–∏–Ω–µ
        if cart_embeddings:
            similarity = max(cosine_sim(product.embedding, e) for e in cart_embeddings)
            score += similarity * 0.3  # –¥–æ +0.3

        # === –§–ò–î–ë–ï–ö –û–¢ –ü–û–õ–¨–ó–û–í–ê–¢–ï–õ–ï–ô ===
        # –ì–ª–∞–≤–Ω—ã–π —Ñ–∞–∫—Ç–æ—Ä –æ–±—É—á–µ–Ω–∏—è —Å–∏—Å—Ç–µ–º—ã!
        stats = get_scenario_feedback_stats(scenario_id, product.id)
        if stats.total > 0:
            # –ë–∞–π–µ—Å–æ–≤—Å–∫–æ–µ —Å–≥–ª–∞–∂–∏–≤–∞–Ω–∏–µ: (positive + 1) / (total + 2)
            approval_rate = (stats.positive + 1) / (stats.total + 2)
            score += (approval_rate - 0.5) * 0.5  # –æ—Ç -0.25 –¥–æ +0.25

            # –ü—Ä–∏–º–µ—Ä: 10 –ª–∞–π–∫–æ–≤, 2 –¥–∏–∑–ª–∞–π–∫–∞ ‚Üí approval = 0.846 ‚Üí +0.17 –∫ —Å–∫–æ—Ä—É

        # === –°–ö–ò–î–ö–ê ===
        if product.discount_price:
            discount_percent = (product.price - product.discount_price) / product.price
            score += discount_percent * 0.2  # –¥–æ +0.2 –¥–ª—è 100% —Å–∫–∏–¥–∫–∏

        product.score = score

    # 4. –í–æ–∑–≤—Ä–∞—â–∞–µ–º —Ç–æ–ø –ø–æ —Å–∫–æ—Ä—É
    return sorted(candidates, key=lambda p: p.score, reverse=True)[:limit]
```

### –ö–∞–∫ —Ñ–∏–¥–±–µ–∫ –≤–ª–∏—è–µ—Ç –Ω–∞ —Ä–µ–π—Ç–∏–Ω–≥:

| –§–∏–¥–±–µ–∫ —Ç–æ–≤–∞—Ä–∞ | approval_rate | –í–ª–∏—è–Ω–∏–µ –Ω–∞ —Å–∫–æ—Ä |
|---------------|---------------|-----------------|
| 0 –ª–∞–π–∫–æ–≤, 0 –¥–∏–∑–ª–∞–π–∫–æ–≤ | 0.50 | 0 (–Ω–µ–π—Ç—Ä–∞–ª—å–Ω–æ) |
| 5 –ª–∞–π–∫–æ–≤, 0 –¥–∏–∑–ª–∞–π–∫–æ–≤ | 0.86 | +0.18 |
| 10 –ª–∞–π–∫–æ–≤, 2 –¥–∏–∑–ª–∞–π–∫–∞ | 0.79 | +0.14 |
| 2 –ª–∞–π–∫–∞, 8 –¥–∏–∑–ª–∞–π–∫–æ–≤ | 0.25 | -0.12 |
| 0 –ª–∞–π–∫–æ–≤, 10 –¥–∏–∑–ª–∞–π–∫–æ–≤ | 0.08 | -0.21 |

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** –¢–æ–≤–∞—Ä—ã —Å —Ö–æ—Ä–æ—à–∏–º —Ñ–∏–¥–±–µ–∫–æ–º –ø–æ–¥–Ω–∏–º–∞—é—Ç—Å—è –≤–≤–µ—Ä—Ö, —Å –ø–ª–æ—Ö–∏–º ‚Äî –æ–ø—É—Å–∫–∞—é—Ç—Å—è –∏–ª–∏ –∏—Å—á–µ–∑–∞—é—Ç –∏–∑ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–π.

---

## –•–æ–ª–æ–¥–Ω—ã–π —Å—Ç–∞—Ä—Ç vs –û–±—É—á–µ–Ω–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞

### –î–µ–Ω—å 1 (–•–æ–ª–æ–¥–Ω—ã–π —Å—Ç–∞—Ä—Ç)

–ù–µ—Ç —Ñ–∏–¥–±–µ–∫–∞ ‚Äî —Å–∏—Å—Ç–µ–º–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç —Ç–æ–ª—å–∫–æ –Ω–∞ —ç–º–±–µ–¥–¥–∏–Ω–≥–∞—Ö:

```
–ì—Ä—É–ø–ø–∞ "–ì—Ä—É–Ω—Ç—ã" –¥–ª—è —Å—Ü–µ–Ω–∞—Ä–∏—è "–ù–∞–ª–∏–≤–Ω–æ–π –ø–æ–ª":
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ –¢–æ–≤–∞—Ä                    ‚îÇ –≠–º–±–µ–¥–¥–∏–Ω–≥ ‚îÇ –§–∏–¥–±–µ–∫ ‚îÇ –ò—Ç–æ–≥     ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ –ì—Ä—É–Ω—Ç CERESIT CT17       ‚îÇ 0.82      ‚îÇ 0      ‚îÇ 0.82     ‚îÇ
‚îÇ –ì—Ä—É–Ω—Ç TIKKURILA Euro     ‚îÇ 0.79      ‚îÇ 0      ‚îÇ 0.79     ‚îÇ
‚îÇ –ì—Ä—É–Ω—Ç KNAUF Tiefengrund  ‚îÇ 0.77      ‚îÇ 0      ‚îÇ 0.77     ‚îÇ
‚îÇ –ì—Ä—É–Ω—Ç –ë–µ—Ç–æ–Ω–∫–æ–Ω—Ç–∞–∫—Ç       ‚îÇ 0.65      ‚îÇ 0      ‚îÇ 0.65     ‚îÇ
‚îÇ ...–µ—â—ë 200 –≥—Ä—É–Ω—Ç–æ–≤...    ‚îÇ           ‚îÇ        ‚îÇ          ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
‚Üí –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Ç–æ–ø-3 –ø–æ —ç–º–±–µ–¥–¥–∏–Ω–≥–∞–º
```

### –î–µ–Ω—å 30 (–ü–æ—Å–ª–µ –Ω–∞–∫–æ–ø–ª–µ–Ω–∏—è —Ñ–∏–¥–±–µ–∫–∞)

100 –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –æ—Ü–µ–Ω–∏–ª–∏ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏:

```
–ì—Ä—É–ø–ø–∞ "–ì—Ä—É–Ω—Ç—ã" –¥–ª—è —Å—Ü–µ–Ω–∞—Ä–∏—è "–ù–∞–ª–∏–≤–Ω–æ–π –ø–æ–ª":
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ –¢–æ–≤–∞—Ä                    ‚îÇ –≠–º–±–µ–¥–¥–∏–Ω–≥ ‚îÇ –§–∏–¥–±–µ–∫ (üëç/üëé)  ‚îÇ –ò—Ç–æ–≥     ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ –ì—Ä—É–Ω—Ç KNAUF Tiefengrund  ‚îÇ 0.77      ‚îÇ 45/3 ‚Üí +0.21   ‚îÇ 0.98 ‚¨ÜÔ∏è  ‚îÇ
‚îÇ –ì—Ä—É–Ω—Ç CERESIT CT17       ‚îÇ 0.82      ‚îÇ 30/10 ‚Üí +0.10  ‚îÇ 0.92     ‚îÇ
‚îÇ –ì—Ä—É–Ω—Ç TIKKURILA Euro     ‚îÇ 0.79      ‚îÇ 15/5 ‚Üí +0.08   ‚îÇ 0.87     ‚îÇ
‚îÇ –ì—Ä—É–Ω—Ç –ë–µ—Ç–æ–Ω–∫–æ–Ω—Ç–∞–∫—Ç       ‚îÇ 0.65      ‚îÇ 5/25 ‚Üí -0.15   ‚îÇ 0.50 ‚¨áÔ∏è  ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
‚Üí KNAUF –ø–æ–¥–Ω—è–ª—Å—è –Ω–∞ 1 –º–µ—Å—Ç–æ –±–ª–∞–≥–æ–¥–∞—Ä—è —Ñ–∏–¥–±–µ–∫—É!
‚Üí –ë–µ—Ç–æ–Ω–∫–æ–Ω—Ç–∞–∫—Ç —É–ø–∞–ª ‚Äî –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ —Å—á–∏—Ç–∞—é—Ç –µ–≥–æ –Ω–µ–ø–æ–¥—Ö–æ–¥—è—â–∏–º –¥–ª—è –Ω–∞–ª–∏–≤–Ω–æ–≥–æ –ø–æ–ª–∞
```

### –ù–µ–ø—Ä–µ—Ä—ã–≤–Ω–æ–µ –æ–±—É—á–µ–Ω–∏–µ

–ö–∞–∂–¥—ã–π –Ω–æ–≤—ã–π —Ñ–∏–¥–±–µ–∫ **–º–≥–Ω–æ–≤–µ–Ω–Ω–æ** –≤–ª–∏—è–µ—Ç –Ω–∞ —Ä–µ–π—Ç–∏–Ω–≥:

```
–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–∞–∂–∞–ª üëç –Ω–∞ "–ì—Ä—É–Ω—Ç KNAUF Tiefengrund"
  ‚Üì
UPDATE scenario_feedback_stats
SET positive_count = positive_count + 1
WHERE scenario_id = 'floor' AND product_id = 12345
  ‚Üì
–°–ª–µ–¥—É—é—â–∏–π –∑–∞–ø—Ä–æ—Å —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–π —É–∂–µ —É—á—Ç—ë—Ç –Ω–æ–≤—ã–π —Ñ–∏–¥–±–µ–∫
```

**–í–∞–∂–Ω–æ:** –ú—ã –ù–ï –ø–µ—Ä–µ–æ–±—É—á–∞–µ–º ML-–º–æ–¥–µ–ª—å. "–û–±—É—á–µ–Ω–∏–µ" ‚Äî —ç—Ç–æ –ø—Ä–æ—Å—Ç–æ –Ω–∞–∫–æ–ø–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –≤ –ë–î.

---

## –®–∞–≥–∏ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

### –ß–µ–∫–ø–æ–∏–Ω—Ç 1: –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö
- [ ] –°–æ–∑–¥–∞—Ç—å —Ç–∞–±–ª–∏—Ü—ã scenarios, scenario_categories
- [ ] –°–æ–∑–¥–∞—Ç—å —Ç–∞–±–ª–∏—Ü—ã scenario_feedback, scenario_feedback_stats
- [ ] –°–æ–∑–¥–∞—Ç—å —Ç–∞–±–ª–∏—Ü—ã product_pair_feedback, pair_feedback_stats
- [ ] –ó–∞–ø–æ–ª–Ω–∏—Ç—å —Å—Ü–µ–Ω–∞—Ä–∏–∏ White Box —Å –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º–∏
- [ ] –ú–∞–ø–ø–∏–Ω–≥ –∫–∞—Ç–µ–≥–æ—Ä–∏–π –∏–∑ YML –Ω–∞ –≥—Ä—É–ø–ø—ã —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤

### –ß–µ–∫–ø–æ–∏–Ω—Ç 2: API —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–π –ø–æ —Ç–æ–≤–∞—Ä—É (–¢–∏–ø 1)
- [ ] GET /recommendations/{product_id} ‚Äî 20 —Å–æ–ø—É—Ç—Å—Ç–≤—É—é—â–∏—Ö —Ç–æ–≤–∞—Ä–æ–≤
- [ ] –ê–ª–≥–æ—Ä–∏—Ç–º detect_scenario_for_product
- [ ] –ê–ª–≥–æ—Ä–∏—Ç–º calculate_product_score (—ç–º–±–µ–¥–¥–∏–Ω–≥–∏ + —Ñ–∏–¥–±–µ–∫)
- [ ] –§–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ match_reasons –¥–ª—è –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏–∏
- [ ] POST /feedback —Å context="product_page"

### –ß–µ–∫–ø–æ–∏–Ω—Ç 3: API —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–π –ø–æ —Å—Ü–µ–Ω–∞—Ä–∏—é (–¢–∏–ø 2)
- [ ] GET /scenarios ‚Äî —Å–ø–∏—Å–æ–∫ —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤
- [ ] GET /scenarios/{id} ‚Äî –¥–µ—Ç–∞–ª–∏ —Å –≥—Ä—É–ø–ø–∞–º–∏
- [ ] GET /scenarios/{id}/recommendations ‚Äî —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ —Å —É—á—ë—Ç–æ–º –∫–æ—Ä–∑–∏–Ω—ã
- [ ] POST /scenarios/{id}/feedback ‚Äî —Ñ–∏–¥–±–µ–∫

### –ß–µ–∫–ø–æ–∏–Ω—Ç 4: ML-–∞–ª–≥–æ—Ä–∏—Ç–º—ã
- [ ] –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —ç–º–±–µ–¥–¥–∏–Ω–≥–æ–≤ —á–µ—Ä–µ–∑ Ollama
- [ ] FAISS –∏–Ω–¥–µ–∫—Å –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –ø–æ–∏—Å–∫–∞
- [ ] –ü–æ–¥–±–æ—Ä —Ç–æ–≤–∞—Ä–æ–≤ –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º –≥—Ä—É–ø–ø—ã
- [ ] –†–∞–Ω–∂–∏—Ä–æ–≤–∞–Ω–∏–µ (—ç–º–±–µ–¥–¥–∏–Ω–≥–∏ + —Ñ–∏–¥–±–µ–∫ + —Å–∫–∏–¥–∫–∏)
- [ ] Fallback –Ω–∞ –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤—ã/—Ä–∞—Å—Ö–æ–¥–Ω–∏–∫–∏

### –ß–µ–∫–ø–æ–∏–Ω—Ç 5: Frontend ‚Äî —Å—Ç—Ä–∞–Ω–∏—Ü–∞ —Ç–æ–≤–∞—Ä–∞
- [ ] –ë–ª–æ–∫ "–°–æ–ø—É—Ç—Å—Ç–≤—É—é—â–∏–µ —Ç–æ–≤–∞—Ä—ã" —Å 20 —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è–º–∏
- [ ] –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Ä–µ–π—Ç–∏–Ω–≥–∞ —Å—Ö–æ–∂–µ—Å—Ç–∏ (—à–∫–∞–ª–∞ + %)
- [ ] Radiobutton "–ü–æ–¥–æ—à—ë–ª / –ù–µ –ø–æ–¥–æ—à—ë–ª" + –∫–Ω–æ–ø–∫–∞ "–û—Ü–µ–Ω–∏—Ç—å"
- [ ] –ë–ª–æ–∫ "–ü–æ—á–µ–º—É —Ä–µ–∫–æ–º–µ–Ω–¥–æ–≤–∞–Ω—ã" (–≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏–∑–Ω–∞–∫–æ–≤)

### –ß–µ–∫–ø–æ–∏–Ω—Ç 6: Frontend ‚Äî –±–ª–æ–∫ –Ω–∞ –≥–ª–∞–≤–Ω–æ–π
- [ ] –ö–æ–º–ø–æ–Ω–µ–Ω—Ç ScenarioRecommendations
- [ ] –°—Ç—Ä–µ–ª–∫–∏ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤
- [ ] –ö–∞—Ä—Ç–æ—á–∫–∏ —Ç–æ–≤–∞—Ä–æ–≤ —Å –∫–Ω–æ–ø–∫–æ–π "–í –∫–æ—Ä–∑–∏–Ω—É"
- [ ] –ü—Ä–æ–≥—Ä–µ—Å—Å-–±–∞—Ä —Å—Ü–µ–Ω–∞—Ä–∏—è
- [ ] –ö–Ω–æ–ø–∫–∞ "–í—Å–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏"

### –ß–µ–∫–ø–æ–∏–Ω—Ç 7: Frontend ‚Äî —Å—Ç—Ä–∞–Ω–∏—Ü—ã —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤
- [ ] /scenarios ‚Äî —Å–ø–∏—Å–æ–∫ –≤—Å–µ—Ö —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤
- [ ] /scenarios/{id} ‚Äî –¥–µ—Ç–∞–ª—å–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ —Å—Ü–µ–Ω–∞—Ä–∏—è
- [ ] –ì—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞ —Ç–æ–≤–∞—Ä–æ–≤ –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º
- [ ] –§–∏–¥–±–µ–∫ (–ø–æ–¥–æ—à—ë–ª/–Ω–µ –ø–æ–¥–æ—à—ë–ª) –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Ç–æ–≤–∞—Ä–∞

### –ß–µ–∫–ø–æ–∏–Ω—Ç 8: –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –∫–æ—Ä–∑–∏–Ω–æ–π
- [ ] –ü—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –∫–æ—Ä–∑–∏–Ω—ã ‚Äî –ø–µ—Ä–µ—Å—á—ë—Ç —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–π
- [ ] –ê–≤—Ç–æ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Å—Ü–µ–Ω–∞—Ä–∏—è –ø–æ —Ç–æ–≤–∞—Ä–∞–º –≤ –∫–æ—Ä–∑–∏–Ω–µ
- [ ] –û—Ç–º–µ—Ç–∫–∞ —Ç–æ–≤–∞—Ä–æ–≤ –∫–æ—Ç–æ—Ä—ã–µ —É–∂–µ –≤ –∫–æ—Ä–∑–∏–Ω–µ

### –ß–µ–∫–ø–æ–∏–Ω—Ç 9: –ê–Ω–∞–ª–∏—Ç–∏–∫–∞ –∏ –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è –¥–ª—è –ø—Ä–µ–∑–µ–Ω—Ç–∞—Ü–∏–∏
- [ ] –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ —Å—Ü–µ–Ω–∞—Ä–∏—è–º (–ø–æ–ø—É–ª—è—Ä–Ω–æ—Å—Ç—å, conversion)
- [ ] –ì—Ä–∞—Ñ–∏–∫–∏ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è —Ñ–∏–¥–±–µ–∫–∞
- [ ] –ú–∞—Ç—Ä–∏—Ü–∞ —Å–≤—è–∑–µ–π –∫–∞—Ç–µ–≥–æ—Ä–∏–π
- [ ] –ê–Ω–∞–ª–∏—Ç–∏—á–µ—Å–∫–∞—è –∑–∞–ø–∏—Å–∫–∞ —Å –≥–∏–ø–æ—Ç–µ–∑–∞–º–∏

---

## –ê–≤—Ç–æ–≤—ã–±–æ—Ä —Å—Ü–µ–Ω–∞—Ä–∏—è –∏ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –Ω–µ–¥–æ—Å—Ç–∞—é—â–∏—Ö —Ç–æ–≤–∞—Ä–æ–≤

### –ü—Ä–æ–±–ª–µ–º–∞: —Ç–æ–≤–∞—Ä—ã –∏–∑ —Ä–∞–∑–Ω—ã—Ö —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤ –≤ –∫–æ—Ä–∑–∏–Ω–µ

–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –º–æ–∂–µ—Ç –¥–æ–±–∞–≤–∏—Ç—å –≤ –∫–æ—Ä–∑–∏–Ω—É —Ç–æ–≤–∞—Ä—ã –∏–∑ —Ä–∞–∑–Ω—ã—Ö —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤:
- –†–æ–≤–Ω–∏—Ç–µ–ª—å (–Ω–∞–ª–∏–≤–Ω–æ–π –ø–æ–ª)
- –®—Ç—É–∫–∞—Ç—É—Ä–∫–∞ (–≤—ã—Ä–∞–≤–Ω–∏–≤–∞–Ω–∏–µ —Å—Ç–µ–Ω)
- –ì–∞–∑–æ–±–ª–æ–∫ (–ø–µ—Ä–µ–≥–æ—Ä–æ–¥–∫–∏)

**–†–µ—à–µ–Ω–∏–µ:** –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–Ω—ã–π —Å—Ü–µ–Ω–∞—Ä–∏–π + –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è —Å—Ç—Ä–µ–ª–∫–∞–º–∏.

---

### –ê–ª–≥–æ—Ä–∏—Ç–º –≤—ã–±–æ—Ä–∞ –∞–∫—Ç–∏–≤–Ω–æ–≥–æ —Å—Ü–µ–Ω–∞—Ä–∏—è

```python
def select_active_scenario(cart_products: list[Product], all_scenarios: list[Scenario]) -> ScenarioMatch:
    """
    –í—ã–±–∏—Ä–∞–µ—Ç —Å—Ü–µ–Ω–∞—Ä–∏–π —Å –º–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–º –ø—Ä–æ—Ü–µ–Ω—Ç–æ–º –∑–∞–ø–æ–ª–Ω–µ–Ω–∏—è.
    –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –≤—Å–µ—Ö —Å—Ü–µ–Ω–∞—Ä–∏—è—Ö –¥–ª—è –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è.
    """
    matches = []

    for scenario in all_scenarios:
        # –°—á–∏—Ç–∞–µ–º —Å–∫–æ–ª—å–∫–æ –≥—Ä—É–ø–ø —Å—Ü–µ–Ω–∞—Ä–∏—è –∑–∞–∫—Ä—ã—Ç–æ —Ç–æ–≤–∞—Ä–∞–º–∏ –∏–∑ –∫–æ—Ä–∑–∏–Ω—ã
        completed_groups = 0
        total_required_groups = 0

        for group in scenario.groups:
            if group.is_required:
                total_required_groups += 1

            # –ü—Ä–æ–≤–µ—Ä—è–µ–º: –µ—Å—Ç—å –ª–∏ –≤ –∫–æ—Ä–∑–∏–Ω–µ —Ç–æ–≤–∞—Ä –∏–∑ –∫–∞—Ç–µ–≥–æ—Ä–∏–π —ç—Ç–æ–π –≥—Ä—É–ø–ø—ã?
            group_satisfied = any(
                product.category_id in group.category_ids
                for product in cart_products
            )

            if group_satisfied:
                completed_groups += 1

        # –ü—Ä–æ—Ü–µ–Ω—Ç –∑–∞–ø–æ–ª–Ω–µ–Ω–∏—è (—Ç–æ–ª—å–∫–æ –ø–æ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–º –≥—Ä—É–ø–ø–∞–º)
        if total_required_groups > 0:
            progress = completed_groups / total_required_groups
        else:
            progress = 0

        matches.append({
            "scenario_id": scenario.id,
            "scenario_name": scenario.name,
            "completed_groups": completed_groups,
            "total_groups": len(scenario.groups),
            "required_groups": total_required_groups,
            "progress": progress,  # 0.0 - 1.0
        })

    # –°–æ—Ä—Ç–∏—Ä—É–µ–º –ø–æ –ø—Ä–æ—Ü–µ–Ω—Ç—É –∑–∞–ø–æ–ª–Ω–µ–Ω–∏—è (—É–±—ã–≤–∞–Ω–∏–µ)
    matches.sort(key=lambda x: x["progress"], reverse=True)

    # –ê–∫—Ç–∏–≤–Ω—ã–π —Å—Ü–µ–Ω–∞—Ä–∏–π ‚Äî —Å –º–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–º –ø—Ä–æ–≥—Ä–µ—Å—Å–æ–º
    # –ï—Å–ª–∏ –≤—Å–µ –ø–æ –Ω—É–ª—è–º ‚Äî –±–µ—Ä—ë–º –ø–µ—Ä–≤—ã–π (–¥–µ—Ñ–æ–ª—Ç–Ω—ã–π)
    active = matches[0] if matches else None

    return {
        "active": active,
        "all_scenarios": matches,  # –î–ª—è –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è —Å—Ç—Ä–µ–ª–∫–∞–º–∏
    }
```

### –ü—Ä–∏–º–µ—Ä —Ä–∞–±–æ—Ç—ã –∞–ª–≥–æ—Ä–∏—Ç–º–∞

**–ö–æ—Ä–∑–∏–Ω–∞:**
- –†–æ–≤–Ω–∏—Ç–µ–ª—å PLITONIT (–∫–∞—Ç–µ–≥–æ—Ä–∏—è: –°–º–µ—Å–∏ –¥–ª—è –ø–æ–ª–∞)
- –ì—Ä—É–Ω—Ç CERESIT (–∫–∞—Ç–µ–≥–æ—Ä–∏—è: –ì—Ä—É–Ω—Ç–æ–≤–∫–∏)

**–†–∞—Å—á—ë—Ç –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Å—Ü–µ–Ω–∞—Ä–∏—è:**

| –°—Ü–µ–Ω–∞—Ä–∏–π | –ó–∞–∫—Ä—ã—Ç–æ –≥—Ä—É–ø–ø | –í—Å–µ–≥–æ –≥—Ä—É–ø–ø | –ü—Ä–æ–≥—Ä–µ—Å—Å |
|----------|---------------|-------------|----------|
| –ù–∞–ª–∏–≤–Ω–æ–π –ø–æ–ª | 2 (–û—Å–Ω–æ–≤–∞ ‚úì, –ì—Ä—É–Ω—Ç—ã ‚úì) | 6 | **33%** |
| –í—ã—Ä–∞–≤–Ω–∏–≤–∞–Ω–∏–µ —Å—Ç–µ–Ω | 1 (–ì—Ä—É–Ω—Ç—ã ‚úì) | 6 | 17% |
| –ü–µ—Ä–µ–≥–æ—Ä–æ–¥–∫–∏ | 1 (–ì—Ä—É–Ω—Ç—ã ‚úì) | 6 | 17% |

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** –ê–∫—Ç–∏–≤–Ω—ã–π —Å—Ü–µ–Ω–∞—Ä–∏–π = "–ù–∞–ª–∏–≤–Ω–æ–π –ø–æ–ª" (33%)

---

### –ê–ª–≥–æ—Ä–∏—Ç–º –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –Ω–µ–¥–æ—Å—Ç–∞—é—â–∏—Ö —Ç–æ–≤–∞—Ä–æ–≤

```python
def get_missing_groups(
    scenario: Scenario,
    cart_products: list[Product]
) -> list[MissingGroup]:
    """
    –û–ø—Ä–µ–¥–µ–ª—è–µ—Ç –∫–∞–∫–∏–µ –≥—Ä—É–ø–ø—ã —Ç–æ–≤–∞—Ä–æ–≤ –Ω–µ –∑–∞–∫—Ä—ã—Ç—ã –≤ –∫–æ—Ä–∑–∏–Ω–µ.
    –î–ª—è –∫–∞–∂–¥–æ–π –Ω–µ–∑–∞–∫—Ä—ã—Ç–æ–π –≥—Ä—É–ø–ø—ã –ø–æ–¥–±–∏—Ä–∞–µ—Ç —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏.
    """
    cart_category_ids = {p.category_id for p in cart_products}
    cart_product_ids = {p.id for p in cart_products}

    missing_groups = []
    completed_groups = []

    for group in scenario.groups:
        # –ö–∞–∫–∏–µ —Ç–æ–≤–∞—Ä—ã –∏–∑ –∫–æ—Ä–∑–∏–Ω—ã –∑–∞–∫—Ä—ã–≤–∞—é—Ç —ç—Ç—É –≥—Ä—É–ø–ø—É?
        cart_products_in_group = [
            p for p in cart_products
            if p.category_id in group.category_ids
        ]

        if cart_products_in_group:
            # –ì—Ä—É–ø–ø–∞ –∑–∞–∫—Ä—ã—Ç–∞ ‚Äî –µ—Å—Ç—å —Ç–æ–≤–∞—Ä –≤ –∫–æ—Ä–∑–∏–Ω–µ
            completed_groups.append({
                "group_name": group.name,
                "is_required": group.is_required,
                "status": "completed",
                "cart_products": cart_products_in_group,  # –ß—Ç–æ –∏–º–µ–Ω–Ω–æ –≤ –∫–æ—Ä–∑–∏–Ω–µ
            })
        else:
            # –ì—Ä—É–ø–ø–∞ –ù–ï –∑–∞–∫—Ä—ã—Ç–∞ ‚Äî –Ω—É–∂–Ω–æ —Ä–µ–∫–æ–º–µ–Ω–¥–æ–≤–∞—Ç—å —Ç–æ–≤–∞—Ä—ã
            missing_groups.append({
                "group_name": group.name,
                "is_required": group.is_required,
                "status": "missing",
                "category_ids": group.category_ids,
            })

    return {
        "completed": completed_groups,
        "missing": missing_groups,
    }
```

---

### –ü–æ–ª–Ω—ã–π –∞–ª–≥–æ—Ä–∏—Ç–º —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–π –¥–ª—è –±–ª–æ–∫–∞ –Ω–∞ –≥–ª–∞–≤–Ω–æ–π

```python
def get_scenario_recommendations(
    cart_products: list[Product],
    active_scenario_id: str = None,  # –ï—Å–ª–∏ None ‚Äî –∞–≤—Ç–æ–≤—ã–±–æ—Ä
    limit_per_group: int = 1,  # –ù–∞ –≥–ª–∞–≤–Ω–æ–π –ø–æ 1 —Ç–æ–≤–∞—Ä—É –Ω–∞ –≥—Ä—É–ø–ø—É
) -> ScenarioRecommendations:
    """
    –ì–ª–∞–≤–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è: –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –¥–ª—è –±–ª–æ–∫–∞ –Ω–∞ –≥–ª–∞–≤–Ω–æ–π.
    """
    all_scenarios = get_all_scenarios()

    # 1. –í—ã–±–∏—Ä–∞–µ–º –∞–∫—Ç–∏–≤–Ω—ã–π —Å—Ü–µ–Ω–∞—Ä–∏–π
    if active_scenario_id:
        # –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–µ—Ä–µ–∫–ª—é—á–∏–ª —Å—Ç—Ä–µ–ª–∫–∞–º–∏
        scenario = get_scenario_by_id(active_scenario_id)
    else:
        # –ê–≤—Ç–æ–≤—ã–±–æ—Ä –ø–æ –∫–æ—Ä–∑–∏–Ω–µ
        match = select_active_scenario(cart_products, all_scenarios)
        scenario = get_scenario_by_id(match["active"]["scenario_id"])

    # 2. –û–ø—Ä–µ–¥–µ–ª—è–µ–º –∫–∞–∫–∏–µ –≥—Ä—É–ø–ø—ã –Ω–µ –∑–∞–∫—Ä—ã—Ç—ã
    groups_status = get_missing_groups(scenario, cart_products)

    # 3. –î–ª—è –∫–∞–∂–¥–æ–π –Ω–µ–∑–∞–∫—Ä—ã—Ç–æ–π –≥—Ä—É–ø–ø—ã –ø–æ–¥–±–∏—Ä–∞–µ–º —Ç–æ–≤–∞—Ä—ã
    recommendations = []

    for missing_group in groups_status["missing"]:
        # ML-–ø–æ–¥–±–æ—Ä —Ç–æ–≤–∞—Ä–æ–≤ –¥–ª—è –≥—Ä—É–ø–ø—ã
        group_products = get_group_recommendations(
            scenario_id=scenario.id,
            group_name=missing_group["group_name"],
            category_ids=missing_group["category_ids"],
            cart_products=cart_products,
            limit=limit_per_group,
        )

        if group_products:
            recommendations.append({
                "group_name": missing_group["group_name"],
                "is_required": missing_group["is_required"],
                "products": group_products,
            })

    # 4. –ï—Å–ª–∏ –≤—Å–µ –≥—Ä—É–ø–ø—ã –∑–∞–∫—Ä—ã—Ç—ã ‚Äî –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤—ã
    if not recommendations:
        recommendations = get_alternatives_and_extras(
            scenario=scenario,
            cart_products=cart_products,
            limit=5,
        )

    # 5. –°—á–∏—Ç–∞–µ–º –ø—Ä–æ–≥—Ä–µ—Å—Å
    total_required = sum(1 for g in scenario.groups if g.is_required)
    completed_required = len([
        g for g in groups_status["completed"]
        if g["is_required"]
    ])

    return {
        "scenario": {
            "id": scenario.id,
            "name": scenario.name,
        },
        "progress": {
            "completed": completed_required,
            "total": total_required,
            "percentage": int(completed_required / total_required * 100) if total_required > 0 else 0,
        },
        "recommendations": recommendations,
        "completed_groups": groups_status["completed"],
        "all_scenarios": [  # –î–ª—è —Å—Ç—Ä–µ–ª–æ–∫ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è
            {"id": s.id, "name": s.name}
            for s in all_scenarios
        ],
    }
```

---

### –ü—Ä–∏–º–µ—Ä –æ—Ç–≤–µ—Ç–∞ API

**GET /scenarios/recommendations?cart_product_ids=123,456**

```json
{
  "scenario": {
    "id": "floor",
    "name": "–ú–æ–Ω—Ç–∞–∂ –Ω–∞–ª–∏–≤–Ω–æ–≥–æ –ø–æ–ª–∞"
  },
  "progress": {
    "completed": 2,
    "total": 6,
    "percentage": 33
  },
  "recommendations": [
    {
      "group_name": "–Å–º–∫–æ—Å—Ç–∏",
      "is_required": true,
      "products": [
        {
          "id": 1001479759,
          "name": "–∫–æ–Ω—Ç–µ–π–Ω–µ—Ä —Å—Ç—Ä–æ–∏—Ç–µ–ª—å–Ω—ã–π –∫—Ä—É–≥–ª—ã–π 90–ª —á–µ—Ä–Ω—ã–π",
          "price": 320,
          "score": 0.87,
          "reason": "–ü–æ–ø—É–ª—è—Ä–Ω—ã–π –≤—ã–±–æ—Ä –¥–ª—è –Ω–∞–ª–∏–≤–Ω–æ–≥–æ –ø–æ–ª–∞"
        }
      ]
    },
    {
      "group_name": "–ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç (–≤–∞–ª–∏–∫–∏)",
      "is_required": true,
      "products": [
        {
          "id": 1000966395,
          "name": "–≤–∞–ª–∏–∫ –∏–≥–æ–ª—å—á–∞—Ç—ã–π TOOLBERG 240–º–º",
          "price": 450,
          "score": 0.92,
          "reason": "89% –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –æ–¥–æ–±—Ä–∏–ª–∏"
        }
      ]
    },
    {
      "group_name": "–ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç (–º–∏–∫—Å–µ—Ä)",
      "is_required": true,
      "products": [
        {
          "id": 1000940270,
          "name": "–Ω–∞—Å–∞–¥–∫–∞ –Ω–∞ –º–∏–∫—Å–µ—Ä UGO LOKS 60—Ö400—Ö6–º–º",
          "price": 290,
          "score": 0.85,
          "reason": "–ü–æ–¥—Ö–æ–¥–∏—Ç –¥–ª—è —Å–º–µ—Å–µ–π"
        }
      ]
    }
  ],
  "completed_groups": [
    {
      "group_name": "–û—Å–Ω–æ–≤–∞",
      "cart_products": [{"id": 123, "name": "–†–æ–≤–Ω–∏—Ç–µ–ª—å PLITONIT"}]
    },
    {
      "group_name": "–ì—Ä—É–Ω—Ç—ã",
      "cart_products": [{"id": 456, "name": "–ì—Ä—É–Ω—Ç CERESIT CT17"}]
    }
  ],
  "all_scenarios": [
    {"id": "floor", "name": "–ú–æ–Ω—Ç–∞–∂ –Ω–∞–ª–∏–≤–Ω–æ–≥–æ –ø–æ–ª–∞"},
    {"id": "walls", "name": "–í—ã—Ä–∞–≤–Ω–∏–≤–∞–Ω–∏–µ —Å—Ç–µ–Ω"},
    {"id": "partitions", "name": "–ú–æ–Ω—Ç–∞–∂ –ø–µ—Ä–µ–≥–æ—Ä–æ–¥–æ–∫"}
  ]
}
```

---

### Fallback: –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤—ã –∏ —Ä–∞—Å—Ö–æ–¥–Ω–∏–∫–∏

–ö–æ–≥–¥–∞ –≤—Å–µ –≥—Ä—É–ø–ø—ã –∑–∞–∫—Ä—ã—Ç—ã, –ø–æ–∫–∞–∑—ã–≤–∞–µ–º:

```python
def get_alternatives_and_extras(
    scenario: Scenario,
    cart_products: list[Product],
    limit: int = 5,
) -> list[Recommendation]:
    """
    –í—ã–∑—ã–≤–∞–µ—Ç—Å—è –∫–æ–≥–¥–∞ –≤—Å–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –≥—Ä—É–ø–ø—ã –∑–∞–∫—Ä—ã—Ç—ã.
    """
    recommendations = []

    # 1. –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤—ã: –¥—Ä—É–≥–∏–µ —Ç–æ–≤–∞—Ä—ã –∏–∑ —Ç–µ—Ö –∂–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–π
    for cart_product in cart_products:
        alternatives = get_products_by_category(cart_product.category_id)
        alternatives = [p for p in alternatives if p.id != cart_product.id]

        # –°–æ—Ä—Ç–∏—Ä—É–µ–º –ø–æ: –¥—Ä—É–≥–æ–π –±—Ä–µ–Ω–¥ + —Ö–æ—Ä–æ—à–∏–π —Ñ–∏–¥–±–µ–∫ + —Å–∫–∏–¥–∫–∞
        for alt in alternatives[:2]:
            if alt.vendor != cart_product.vendor:  # –î—Ä—É–≥–æ–π –±—Ä–µ–Ω–¥
                recommendations.append({
                    "product": alt,
                    "reason": f"–ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∞ –¥–ª—è {cart_product.name}",
                    "type": "alternative",
                })

    # 2. –†–∞—Å—Ö–æ–¥–Ω–∏–∫–∏: –±–æ–ª—å—à–µ —Ç–æ–≥–æ –∂–µ —Ç–æ–≤–∞—Ä–∞ –∏–ª–∏ –¥–æ–ø. –µ–¥–∏–Ω–∏—Ü—ã
    for cart_product in cart_products:
        if is_consumable(cart_product):  # –°–º–µ—Å–∏, –ø–ª—ë–Ω–∫–∞ –∏ —Ç.–¥.
            recommendations.append({
                "product": cart_product,
                "reason": "–í–æ–∑—å–º–∏—Ç–µ –µ—â—ë ‚Äî –º–æ–∂–µ—Ç –ø–æ–Ω–∞–¥–æ–±–∏—Ç—å—Å—è",
                "type": "extra",
            })

    # 3. –ù–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –≥—Ä—É–ø–ø—ã —Å—Ü–µ–Ω–∞—Ä–∏—è
    for group in scenario.groups:
        if not group.is_required:
            products = get_group_recommendations(
                scenario_id=scenario.id,
                group_name=group.name,
                category_ids=group.category_ids,
                cart_products=cart_products,
                limit=1,
            )
            if products:
                recommendations.append({
                    "product": products[0],
                    "reason": f"–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ: {group.name}",
                    "type": "optional",
                })

    return recommendations[:limit]
```

---

## –ü—Ä–∏–º–µ—Ä —Ä–∞–±–æ—Ç—ã

### –ö–æ—Ä–∑–∏–Ω–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:
- –†–æ–≤–Ω–∏—Ç–µ–ª—å PLITONIT Universal 20–∫–≥

### –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Å—Ü–µ–Ω–∞—Ä–∏—è:
‚Üí "–ú–æ–Ω—Ç–∞–∂ –Ω–∞–ª–∏–≤–Ω–æ–≥–æ –ø–æ–ª–∞" (—Ç–æ–≤–∞—Ä –∏–∑ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ "–°–º–µ—Å–∏ –¥–ª—è –ø–æ–ª–∞")

### –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏:
```
–î–ª—è –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –Ω–∞–±–æ—Ä–∞:
‚îú‚îÄ‚îÄ –ì—Ä—É–Ω—Ç—ã: –≥—Ä—É–Ω—Ç CERESIT CT17 Pro (890‚ÇΩ) [+]
‚îú‚îÄ‚îÄ –Å–º–∫–æ—Å—Ç–∏: –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä 90–ª (320‚ÇΩ) [+]
‚îú‚îÄ‚îÄ –ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç: –≤–∞–ª–∏–∫ –∏–≥–æ–ª—å—á–∞—Ç—ã–π 240–º–º (450‚ÇΩ) [+]
‚îú‚îÄ‚îÄ –ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç: –Ω–∞—Å–∞–¥–∫–∞ –Ω–∞ –º–∏–∫—Å–µ—Ä (290‚ÇΩ) [+]
‚îî‚îÄ‚îÄ –ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç: —É—Ä–æ–≤–µ–Ω—å 1000–º–º (670‚ÇΩ) [+]

–ü—Ä–æ–≥—Ä–µ—Å—Å: 1/6 –≥—Ä—É–ø–ø (17%)
```

### –ü–æ—Å–ª–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –≥—Ä—É–Ω—Ç–∞:
```
–ü—Ä–æ–≥—Ä–µ—Å—Å: 2/6 –≥—Ä—É–ø–ø (33%)
–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –æ–±–Ω–æ–≤–∏–ª–∏—Å—å ‚Äî –≥—Ä—É–Ω—Ç —É–±—Ä–∞–Ω, –æ—Å—Ç–∞–ª—å–Ω–æ–µ –Ω–∞ –º–µ—Å—Ç–µ
```
